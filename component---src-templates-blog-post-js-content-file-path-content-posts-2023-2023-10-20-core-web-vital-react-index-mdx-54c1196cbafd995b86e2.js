"use strict";(self.webpackChunkmaxpou_fr=self.webpackChunkmaxpou_fr||[]).push([[6597],{2141:function(n,a,e){e.r(a),e.d(a,{default:function(){return f}});var s=e(1151),t=e(7294),o=e(4419),p=e(9273);function c(n){const a=Object.assign({p:"p",a:"a",span:"span",strong:"strong",h2:"h2",em:"em",img:"img",ul:"ul",li:"li"},(0,s.ah)(),n.components);return t.createElement(t.Fragment,null,t.createElement(a.p,null,"The application I’m working on recently had a significant change: we decided to go from something\nwholly closed (behind a connection wall) to something more open. Which means, searchable on the\ninternet."),"\n",t.createElement(o.Z,{title:"💡 A side note about the application"},t.createElement(a.p,null,t.createElement(a.a,{href:"https://ui.orderfox.com/search"},"Partfox")," is a search engine that facilitates connexions between\nmanufacturers and buyers in the CNC industry. In a nutshell, the user can post a technical drawing\non the platform and we show them manufacturers that could make their workpiece."),t.createElement(a.p,null,"Technically it’s a single-page application built with React, TypeScript, and Vite. It’s hosted on\nHeroku.")),"\n",t.createElement(a.p,null,"Two big topics came to the top of my priorities: SEO and Web Performance."),"\n",t.createElement(a.p,null,"As per usual, I started with a Google Lighthouse audit. The result was far from great."),"\n",t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; "\n    >\n      <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 98.64864864864865%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAACO0lEQVR42pVU226rMBDk/3/svPepStoetQkhBDDG+IKvc7QmNCGXVsfSyjbCs7PjWRe4HdECQePRSCnBe48YQ15TLN+XdXF7aPp6gfv8Q7/d54oRQkiM4wilNPggUFV13i+juEqfIUL/hci2d8yWWSmDtu2htUHXMXy8v0MIcQHM9KOHdxbb7RZvb2/YbDaoT+2cIBKzC6DWE4yZMlPOOaSUmKy9AApl8PeosDty7Pd7HKojynKH7V7gpQRej4AL6VxyymAEIKXCMAiU5SHP34AhJDRsAhstojOQQ5cPDc5i1yq03K5Kp5JHqTCOMutIYMaYKw1JO+9nnVJA8FNm4hERokOKYQVIF0MRQsix6PsN6JyDvdLgfwcBEoY/kypIVC7E7KUYn/rren8dxJJso7WeAeE9VNehKUt0XbfSY8XEK/D6gPZUgw/DU8bZh55zBMbuGN3UBtc3CEbdWX7dKc5BMIZTXWctnmrlFVhT41Qd0DOWL+Y5Q8Zg6/o39WGqT0zVDtH7H0omhnxA03VZQ5azUwnrH0UwaAeGvuf5v+v+vWfYnODr6uyzxxq66DFojhTnm31asvUJwkRIk+BDyu4fTcQ4JcQbmgnpV18W2iY0Y0InEyYX55LGkPe3bBffLeHP89I5sw8pb4rnmLV7ZODlPaQepmaQo4SWEkLQ2zg/FOSSAg89hdWlLIB0gMCUklDaYN86SKVzMxAotV9Bi77vc/gf7JBf82nKGlObaWPx0URoM8FZm0Gp7H9KBiHUr7tfVwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n  ></span>\n  <picture>\n          <source\n              srcset="/static/bc20f664475fe90098fbdacb798d31f7/cbe2e/before.webp 148w,\n/static/bc20f664475fe90098fbdacb798d31f7/3084c/before.webp 295w,\n/static/bc20f664475fe90098fbdacb798d31f7/5ca24/before.webp 590w,\n/static/bc20f664475fe90098fbdacb798d31f7/dad35/before.webp 885w,\n/static/bc20f664475fe90098fbdacb798d31f7/2baf0/before.webp 1180w,\n/static/bc20f664475fe90098fbdacb798d31f7/b84eb/before.webp 2000w"\n              sizes="(max-width: 590px) 100vw, 590px"\n              type="image/webp"\n            />\n          <source\n            srcset="/static/bc20f664475fe90098fbdacb798d31f7/12f09/before.png 148w,\n/static/bc20f664475fe90098fbdacb798d31f7/e4a3f/before.png 295w,\n/static/bc20f664475fe90098fbdacb798d31f7/fcda8/before.png 590w,\n/static/bc20f664475fe90098fbdacb798d31f7/efc66/before.png 885w,\n/static/bc20f664475fe90098fbdacb798d31f7/c83ae/before.png 1180w,\n/static/bc20f664475fe90098fbdacb798d31f7/e8950/before.png 2000w"\n            sizes="(max-width: 590px) 100vw, 590px"\n            type="image/png"\n          />\n          <img\n            class="gatsby-resp-image-image"\n            src="/static/bc20f664475fe90098fbdacb798d31f7/fcda8/before.png"\n            alt="before.png"\n            title=""\n            loading="lazy"\n            decoding="async"\n            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n          />\n        </picture>\n    </span>'}}),"\n",t.createElement(o.Z,null,t.createElement(a.p,null,"💡 ",t.createElement(a.strong,null,"Tips:")," when you do an audit with Lighthouse, always use your browser in incognito mode! In\nnormal mode, your AdBlockers automatically block 3rd party libraries, which makes the website load\nfaster.")),"\n",t.createElement(a.p,null,"With the help of Google and Lighthouse, I ended up with a large to-do list."),"\n",t.createElement(a.h2,{id:"step-1-lazy-loading-images",style:{position:"relative"}},t.createElement(a.a,{href:"#step-1-lazy-loading-images","aria-label":"step 1 lazy loading images permalink",className:"anchor before"},t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Step 1: lazy loading images"),"\n",t.createElement(a.p,null,"By default, images in the browser load immediately. It can lead to a bottleneck when you try to\nprint many images on one page. To prevent this, you can change this default attribute and\n",t.createElement(a.a,{href:"https://developer.mozilla.org/en-US/docs/Web/HTML/Element/img#loading"},"lazy load")," images."),"\n",t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// Before</span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/media/banana.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>a banana<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n\n<span class="token comment">// After</span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/media/banana.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>a banana<span class="token punctuation">"</span></span> <span class="token attr-name">loading</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>lazy<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre></div>'}}),"\n",t.createElement(a.p,null,"In a nutshell, you can defer the image loading. When your screen is about to see the image, it loads\nit automatically."),"\n",t.createElement("iframe",{width:"560",height:"315",src:"https://www.youtube.com/embed/TP24UeofpMY",frameborder:"0",allowfullscreen:!0}),"\n",t.createElement(p.Z,{title:"This is not a silver bullet"},t.createElement(a.p,null,"Having too much lazy loading on your page can negatively impact your performance (",t.createElement(a.a,{href:"https://web.dev/lcp-lazy-loading"},"see\nwhy"),").")),"\n",t.createElement(a.h2,{id:"step-2-using-an-image-cdn",style:{position:"relative"}},t.createElement(a.a,{href:"#step-2-using-an-image-cdn","aria-label":"step 2 using an image cdn permalink",className:"anchor before"},t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Step 2: using an image CDN"),"\n",t.createElement(a.p,null,"Most of our assets (images, pdf, video) are hosted on a S3 bucket. When your app directly points to\na S3 bucket you have zero compression, no image optimisation and it uses HTTP 1.1."),"\n",t.createElement(a.p,null,"Using an image CDN addresses these issues. We picked Cloudinary which is a paid product. We decided\nto go for this tool for a simple reason: it’s easy to use."),"\n",t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// before</span>\n<span class="token literal-property property">https</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>s3<span class="token operator">-</span>bucket<span class="token punctuation">.</span>com<span class="token operator">/</span>image<span class="token punctuation">.</span>jpg\n\n<span class="token comment">// after</span>\n<span class="token literal-property property">https</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>res<span class="token punctuation">.</span>cloudinary<span class="token punctuation">.</span>com<span class="token operator">/</span><span class="token punctuation">{</span><span class="token constant">CLOUDINARY_ID</span><span class="token punctuation">}</span><span class="token operator">/</span>image<span class="token operator">/</span>fetch<span class="token operator">/</span>w_80<span class="token punctuation">,</span>h_80<span class="token punctuation">,</span>c_thumb<span class="token operator">/</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>s3<span class="token operator">-</span>bucket<span class="token punctuation">.</span>com<span class="token operator">/</span>image<span class="token punctuation">.</span>jpg</code></pre></div>'}}),"\n",t.createElement(a.p,null,"The 2nd URL will return a thumbnail of 80x80px of the original link. It’s automatically served with\nhttp/2 and the HTTP response has the right headers (for caching)."),"\n",t.createElement(a.h2,{id:"step-3-code-splitting-with-react-router",style:{position:"relative"}},t.createElement(a.a,{href:"#step-3-code-splitting-with-react-router","aria-label":"step 3 code splitting with react router permalink",className:"anchor before"},t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Step 3: code splitting (with react-router)"),"\n","\n",t.createElement(a.p,null,"For routing, we use React Router for linking routes with components. Our routing system was similar\nto this one:"),"\n",t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// Before</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> createBrowserRouter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'react-router-dom\'</span>\n<span class="token keyword">import</span> SearchLanding <span class="token keyword">from</span> <span class="token string">\'@/modules/search/SearchLanding\'</span>\n<span class="token keyword">import</span> ResetPassword <span class="token keyword">from</span> <span class="token string">\'@/modules/account/ResetPassword\'</span>\n\n<span class="token keyword">export</span> <span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">createBrowserRouter</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n  <span class="token punctuation">{</span>\n    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">\'/\'</span><span class="token punctuation">,</span>\n    <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">,</span>\n    <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n      <span class="token punctuation">{</span>\n        <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">\'search\'</span><span class="token punctuation">,</span>\n        <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">SearchLanding</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n        <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">\'reset-password\'</span><span class="token punctuation">,</span>\n        <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ResetPassword</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token comment">// ...</span>\n    <span class="token punctuation">]</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre></div>'}}),"\n",t.createElement(a.p,null,"This generates a big JS file with the entire application. It’s a pity to load the entire application\nwhen you only want to see one page."),"\n",t.createElement(a.p,null,"Fortunately, this problem can be addressed with React Suspense."),"\n",t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// After</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> lazy<span class="token punctuation">,</span> Suspense <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'react\'</span>\n<span class="token keyword">import</span> Loader <span class="token keyword">from</span> <span class="token string">\'@/modules/common/Loader\'</span>\n\n<span class="token keyword">const</span> SearchLanding <span class="token operator">=</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">\'@/modules/search/SearchLanding\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> ResetPassword <span class="token operator">=</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">\'@/modules/account/ResetPassword\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token keyword">export</span> <span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">createBrowserRouter</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n  <span class="token punctuation">{</span>\n    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">\'/\'</span><span class="token punctuation">,</span>\n    <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">,</span>\n    <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n      <span class="token punctuation">{</span>\n        <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">\'search\'</span><span class="token punctuation">,</span>\n        <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token punctuation">(</span>\n          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Suspense</span></span> <span class="token attr-name">fallback</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Loader</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">SearchLanding</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">\n          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Suspense</span></span><span class="token punctuation">></span></span>\n        <span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n        <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">\'reset-password\'</span><span class="token punctuation">,</span>\n        <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token punctuation">(</span>\n          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Suspense</span></span> <span class="token attr-name">fallback</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Loader</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ResetPassword</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">\n          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Suspense</span></span><span class="token punctuation">></span></span>\n        <span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token comment">// ...</span>\n    <span class="token punctuation">]</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre></div>'}}),"\n",t.createElement(a.p,null,"With this, the application will be bundled into many files. So ",t.createElement(a.em,null,"“the user only loads what is\nneeded”"),". When the user goes from one page to another, he will see the loader while the component is\nbeing loaded."),"\n",t.createElement(a.h2,{id:"step-4-using-a-cdn-for-http2",style:{position:"relative"}},t.createElement(a.a,{href:"#step-4-using-a-cdn-for-http2","aria-label":"step 4 using a cdn for http2 permalink",className:"anchor before"},t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Step 4: Using a CDN for HTTP/2"),"\n",t.createElement(a.p,null,"In the previous step, I show you how we went from 1 big JS file to many files (~80). But, loading\nwhat you already need can be very costly. Mostly when you’re only using HTTP/1.1. This protocol only\nallows downloading one file at a time."),"\n",t.createElement(a.p,null,"One of the biggest additions of HTTP/2 (h2) is the\n“",t.createElement(a.a,{href:"https://web.dev/performance-http2/#request-and-response-multiplexing"},"Request and response multiplexing"),"”.\nWhen it came out, it was like a revolution in the browser. It allows the browser to download\nmultiple files with a single request. Because “a picture is worth a thousand words”,\n",t.createElement(a.a,{href:"https://freecontent.manning.com/animation-http-1-1-vs-http-2-vs-http-2-with-push/"},"here’s a cool animation"),"\nif you want to better understand why h2 is faster."),"\n",t.createElement(a.p,null,"Our application was running on a Heroku dyno. Unfortunately, they do not support h2 (at the time\nbeing). To get it, while keeping our Heroku infrastructure, the solution is to use a CDN. CloudFront\n(AWS product) was the most relevant pick for us because we already had a few tools using the AWS\nsuite. Same as our image CDN, CloudFront gives us a bunch of good additions such as h2, optimised\ncaching… But it’s a hell of a mess to configure."),"\n",t.createElement(a.h2,{id:"step-5-lazy-load-big-components",style:{position:"relative"}},t.createElement(a.a,{href:"#step-5-lazy-load-big-components","aria-label":"step 5 lazy load big components permalink",className:"anchor before"},t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Step 5: lazy load big components"),"\n",t.createElement(a.p,null,"Our coolest component is also the worst in terms of performance. When a user uploads a technical\ndrawing, we render it in 3D. Under the hood, it uses a bunch of three.js libraries which render HTML\ncanvas. The component itself weighs ~2Mb (thanks Three.js!)."),"\n",t.createElement(a.img,{src:"/dd70835a4a36d4f6cb1b6933576e2fd7/3D-preview.gif",alt:"3D-preview.gif"}),"\n",t.createElement(a.p,null,"Unfortunately for us, these technical drawings can also be cumbersome. The file needed to display\nthe canvas ranges from 1 to ~12MB. On our feed page, we can display a lot of them."),"\n",t.createElement(a.p,null,"I ended up with a solution mixing React.suspense and a custom hook:"),"\n",t.createElement(a.ul,null,"\n",t.createElement(a.li,null,"React.suspense - to defer loading the JS assets needed to show the component."),"\n",t.createElement(a.li,null,"A ",t.createElement(a.a,{href:"https://gist.github.com/maxpou/f235ef5b2e0f63b3a32e78f484b081c8"},t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">useIsVisibleOnScreen</code>'}})," hook")," -\nto defer loading the assets needed to show the 3D piece. In a nutshell, this hook detects if the\ncomponent is in the viewport or if he is about to be seen."),"\n"),"\n",t.createElement(a.h2,{id:"outcome",style:{position:"relative"}},t.createElement(a.a,{href:"#outcome","aria-label":"outcome permalink",className:"anchor before"},t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Outcome"),"\n",t.createElement(a.p,null,"…after I these changes, I did another bunch of audits and tada! I finally got a more decent score 🎉"),"\n",t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; "\n    >\n      <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 111.48648648648648%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAAsTAAALEwEAmpwYAAACm0lEQVR42q1VyW7bMBT0/39RgZ576KXopY3rFJGjNJEly+K+i5zi0Uvi2GkQoAQoitTjvH20wH8ei5ebWGas3YDG9VeFSykIIWKeZ+ScMc+5ntGk/QmwoNTNfZzwufuCT8NXBOQLQAJSSkNrDWsdpFTohwFdt6mKziwsuUA5i+/8Dr91hzxfAtKZ9wGMCWhtwJnA7a8VblcrxJj2gDnPyHOEVhKr5Q2WyyVufvxE27ZwqSCkvasVMJdqGYGSRbsdA5sYjHVIad4DGhvQPEmsNxpNJ9D3HYahr64sHxRungqOxlKcrPVwjgADpomj7we0D4/PFqYMSA8It5+rTcRGkNUJKUbYSEF/BjTGQyoL7zyEUBiGAe26QUoHQKSEoCRCjEC2UHyE1g4ZBVsn4Iw5c5kukrvkIlnpPVlsX2WZ0n5If8nzqRTmnCvIh+pQCAnG+MmKjw66J6WsM8aIxRwdnDWwzsMYU114KXxUFEqqF4ILVe4Ys+rJPNdJ7wvkAL0bMLYNGGO1aK8NWyI6vkGzuatyFL+rLlMoS4woRgPvuO2SgwrqIjwvPVmo7NCzLdZPLay1b4KpEjDwEc2fBpt+A2vs2+RAWnvVnXr6SujrUwSOVrTwyf+DbZKBlgLTbsI4jthutzX451CAyA5CK7Bx324kdy2O1cIoGcxjg0y09EYcqdAnOyFEf5bVC0Dq6ZAKfCCOI4pK9d1H4NDvZ8F/t7CVy+h4QcczTAQ4m9CNBr0EhC0np49gx4ye5mvAvSAxsQdnHI6anota4JxzWOfqaoyta+VBWo2FEAde5AJK69oti6MWqnxiY0oIfSQ6oiInIqCVFFCH0J7KixIipKncSCVE3+l88ZGeVUpW66QUVfm3+4JJaFhz/C1Y/AVBuLoP+rAFbgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n  ></span>\n  <picture>\n          <source\n              srcset="/static/cbb2e229d7a3ffb44f93c49f9ee1b780/cbe2e/after.webp 148w,\n/static/cbb2e229d7a3ffb44f93c49f9ee1b780/3084c/after.webp 295w,\n/static/cbb2e229d7a3ffb44f93c49f9ee1b780/5ca24/after.webp 590w,\n/static/cbb2e229d7a3ffb44f93c49f9ee1b780/dad35/after.webp 885w,\n/static/cbb2e229d7a3ffb44f93c49f9ee1b780/2baf0/after.webp 1180w,\n/static/cbb2e229d7a3ffb44f93c49f9ee1b780/b84eb/after.webp 2000w"\n              sizes="(max-width: 590px) 100vw, 590px"\n              type="image/webp"\n            />\n          <source\n            srcset="/static/cbb2e229d7a3ffb44f93c49f9ee1b780/12f09/after.png 148w,\n/static/cbb2e229d7a3ffb44f93c49f9ee1b780/e4a3f/after.png 295w,\n/static/cbb2e229d7a3ffb44f93c49f9ee1b780/fcda8/after.png 590w,\n/static/cbb2e229d7a3ffb44f93c49f9ee1b780/efc66/after.png 885w,\n/static/cbb2e229d7a3ffb44f93c49f9ee1b780/c83ae/after.png 1180w,\n/static/cbb2e229d7a3ffb44f93c49f9ee1b780/e8950/after.png 2000w"\n            sizes="(max-width: 590px) 100vw, 590px"\n            type="image/png"\n          />\n          <img\n            class="gatsby-resp-image-image"\n            src="/static/cbb2e229d7a3ffb44f93c49f9ee1b780/fcda8/after.png"\n            alt="after.png"\n            title=""\n            loading="lazy"\n            decoding="async"\n            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n          />\n        </picture>\n    </span>'}}),"\n",t.createElement(a.p,null,"I know what you think: it could be 100."),"\n",t.createElement(a.p,null,"But, this is not a side project, nor a “Hello World” project. Focusing on the last 10 remaining\npoints would be too time-consuming for me. It’s not worth the trouble."),"\n",t.createElement(a.p,null,"What I liked about this journey was the simplicity of the actions to obtain a decent performance\nscore. I mean, it’s not rocket science. I mostly followed tips given by Lighthouse and other best\npractices that can easily be found on the internet."))}var l=function(n){void 0===n&&(n={});const{wrapper:a}=Object.assign({},(0,s.ah)(),n.components);return a?t.createElement(a,n,t.createElement(c,n)):c(n)},r=e(4222),i=e(418),u=e(4529),d=e(7953),h=e(4849),g=e(5536),m=e(2404);function k(n){let{data:a,pageContext:e,children:s,location:o}=n;const p=a.post,{previous:c,next:l}=e;return t.createElement(r.Z,{location:o},t.createElement(g.Z,{title:p.frontmatter.title,description:p.frontmatter.description||p.excerpt,cover:p.frontmatter.cover&&p.frontmatter.cover.publicURL,imageShare:p.frontmatter.imageShare&&p.frontmatter.imageShare.publicURL,lang:p.frontmatter.language,translations:p.frontmatter.translations,path:p.frontmatter.slug,isBlogPost:!0}),t.createElement(u.Z,{heroImg:p.frontmatter.cover,title:p.frontmatter.title}),t.createElement(i.Z,null,t.createElement(d.Z,{post:p},s)),t.createElement(i.Z,{as:"aside"},t.createElement(m.Z,{slug:p.frontmatter.slug,title:p.frontmatter.title,redditPostId:p.frontmatter.redditPostId})),t.createElement(h.Z,{previous:c,next:l}))}function f(n){return t.createElement(k,n,t.createElement(l,n))}},4419:function(n,a,e){var s=e(7294),t=e(5086);const o=t.default.aside.withConfig({displayName:"Info__MessageWrapper",componentId:"sc-1w6ti9r-0"})(["color:var(--color-grey500);box-sizing:border-box;background-color:#bfe2ff;border-left:5px solid #0165b7;margin:30px 0px;padding:20px;border-radius:0 8px 8px 0;a{color:var(--color-grey500);}"]),p=t.default.div.withConfig({displayName:"Info__MessageHeader",componentId:"sc-1w6ti9r-1"})(["font-weight:bold;& > svg{position:relative;top:5px;width:25px;height:25px;padding-right:5px;}"]);a.Z=n=>{let{children:a,title:e}=n;return s.createElement(o,null,e&&s.createElement(p,null,e),a)}},9273:function(n,a,e){e.d(a,{Z:function(){return l}});var s=e(7294),t=e(5086);var o=n=>s.createElement("svg",Object.assign({"aria-label":"Warning",x:"0px",y:"0px",width:"554.2px",height:"554.199px",viewBox:"0 0 554.2 554.199"},n),s.createElement("path",{fill:"currentColor",d:"M538.5,386.199L356.5,70.8c-16.4-28.4-46.7-45.9-79.501-45.9c-32.8,0-63.1,17.5-79.5,45.9L12.3,391.6 c-16.4,28.4-16.4,63.4,0,91.8C28.7,511.8,59,529.3,91.8,529.3H462.2c0.101,0,0.2,0,0.2,0c50.7,0,91.8-41.101,91.8-91.8 C554.2,418.5,548.4,400.8,538.5,386.199z M316.3,416.899c0,21.7-16.7,38.3-39.2,38.3s-39.2-16.6-39.2-38.3V416 c0-21.601,16.7-38.301,39.2-38.301S316.3,394.3,316.3,416V416.899z M317.2,158.7L297.8,328.1c-1.3,12.2-9.4,19.8-20.7,19.8 s-19.4-7.7-20.7-19.8L237,158.6c-1.3-13.1,5.801-23,18-23H299.1C311.3,135.7,318.5,145.6,317.2,158.7z"}));const p=t.default.aside.withConfig({displayName:"Warning__MessageWrapper",componentId:"sc-1wn3vns-0"})(["color:var(--color-grey500);box-sizing:border-box;background-color:#fdf4ba;border-left:5px solid var(--color-grey600);margin:30px 0px;padding:20px;border-radius:0 8px 8px 0;& a{color:var(--color-primary);}"]),c=t.default.div.withConfig({displayName:"Warning__MessageHeader",componentId:"sc-1wn3vns-1"})(["font-weight:bold;& > svg{position:relative;top:5px;width:25px;height:25px;padding-right:5px;}"]);var l=n=>{let{children:a,title:e}=n;return s.createElement(p,null,s.createElement(c,null,s.createElement(o,null),e),s.createElement("div",null,a))}}}]);
//# sourceMappingURL=component---src-templates-blog-post-js-content-file-path-content-posts-2023-2023-10-20-core-web-vital-react-index-mdx-54c1196cbafd995b86e2.js.map