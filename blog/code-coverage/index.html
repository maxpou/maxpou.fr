<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Astro v4.7.0"><!-- Font preloads --><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Lato:400,700&display=swap"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700&display=swap" media="print"><!-- Canonical URL --><link rel="canonical" href="https://www.maxpou.fr/blog/code-coverage/"><!-- Primary Meta Tags --><title>Why you shouldn&#39;t pay too much attention to your code coverage</title><meta name="title" content="Why you shouldn't pay too much attention to your code coverage"><meta name="description" content="A blog post written by Maxence Poutord"><script async defer data-domain="maxpou.fr" src="https://plausible.io/js/plausible.js"></script><link rel="alternate" type="application/rss+xml" title="Maxence Poutord • Maxpou Blog" href="/rss.xml"><link rel="sitemap" type="application/xml" href="/sitemap-index.xml"><!-- Open Graph / Facebook --><meta property="og:type" content="article"><meta property="og:url" content="https://www.maxpou.fr/blog/code-coverage/"><meta property="og:title" content="Why you shouldn't pay too much attention to your code coverage"><meta property="og:description" content="A blog post written by Maxence Poutord"><meta property="og:image" content="https://www.maxpou.fr/og/code-coverage.png"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://www.maxpou.fr/blog/code-coverage/"><meta property="twitter:title" content="Why you shouldn't pay too much attention to your code coverage"><meta property="twitter:description" content="A blog post written by Maxence Poutord"><meta name="twitter:creator" content="_maxpou"><meta property="twitter:image" content="https://www.maxpou.fr/og/code-coverage.png"><script>
  const theme = (() => {
    if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
      return localStorage.getItem('theme')
    }
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
      return 'dark'
    }
    return 'light'
  })()

  if (theme === 'light') {
    document.documentElement.classList.remove('dark')
  } else {
    document.documentElement.classList.add('dark')
  }
  window.localStorage.setItem('theme', theme)
</script><link rel="stylesheet" href="/_astro/_slug_.C7GyTbYu.css">
<style>code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.comment,.token.block-comment,.token.prolog,.token.doctype,.token.cdata{color:#999}.token.punctuation{color:#ccc}.token.tag,.token.attr-name,.token.namespace,.token.deleted{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.number,.token.function{color:#f08d49}.token.property,.token.class-name,.token.constant,.token.symbol{color:#f8c555}.token.selector,.token.important,.token.atrule,.token.keyword,.token.builtin{color:#cc99cd}.token.string,.token.char,.token.attr-value,.token.regex,.token.variable{color:#7ec699}.token.operator,.token.entity,.token.url{color:#67cdcc}.token.important,.token.bold{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}.expressive-code{margin-top:1em}
</style>
<link rel="stylesheet" href="/_astro/_slug_.CAJRwR26.css">
<style>footer[data-astro-cid-sz7xmlte]{padding:2em 1em 6em;color:rgb(var(--gray))}a[data-astro-cid-eimmu3lg]{display:inline-block;text-decoration:none;border-bottom:4px solid transparent}a[data-astro-cid-eimmu3lg].active{font-weight:bolder;border-bottom-color:#ffdc4e}*{transition:background .5s ease}*::-moz-selection{background-color:#ffdc4e;color:#3e4047}*::selection{background-color:#ffdc4e;color:#3e4047}
</style><script type="module">const n=document.getElementById("burger-button"),e=document.getElementById("burger-line-1"),r=document.getElementById("burger-line-2"),t=document.getElementById("burger-line-3"),o=document.getElementById("menu-backdrop");n.addEventListener("click",()=>{o.classList.contains("hidden")?(o.classList.add("flex"),o.classList.remove("hidden"),e.style.transform="rotate(45deg)",e.style.top="0",e.style.backgroundColor="white",r.style.backgroundColor="transparent",t.style.transform="rotate(-45deg)",t.style.top="0",t.style.backgroundColor="white"):(e.style.transform="rotate(0)",e.style.removeProperty("top"),e.style.removeProperty("background-color"),r.style.removeProperty("background-color"),t.style.removeProperty("background-color"),t.style.transform="rotate(0)",t.style.removeProperty("top"),o.classList.add("hidden"),o.classList.remove("flex"))});
</script></head> <body class="bg-gradient-to-b from-blue-50 to-[#f5f7f9] dark:bg-gray-600 dark:bg-gradient-to-b dark:from-gray-600"> <header class="bg-white dark:bg-gray-600 px-4 h-16"> <nav class="dark:text-white h-16 flex items-center justify-between max-w-screen-xl w-full mx-auto"> <h1 class="text-lg dark:text-white font-bold"> <a href="/">Maxence Poutord</a> </h1> <div class="md:flex hidden"> <a href="/blog" class="py-4 px-2 no-underline text-lg hover:text-blue-900 dark:text-white dark:hover:text-mainYellow" data-astro-cid-eimmu3lg> Blog </a>  <a href="/speaking" class="py-4 px-2 no-underline text-lg hover:text-blue-900 dark:text-white dark:hover:text-mainYellow" data-astro-cid-eimmu3lg> Speaking </a>  <a href="/about" class="py-4 px-2 no-underline text-lg hover:text-blue-900 dark:text-white dark:hover:text-mainYellow" data-astro-cid-eimmu3lg> About </a>  <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).only=e;window.dispatchEvent(new Event("astro:only"));})();;(()=>{var A=Object.defineProperty;var g=(a,o,i)=>o in a?A(a,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[o]=i;var d=(a,o,i)=>(g(a,typeof o!="symbol"?o+"":o,i),i);{let a={0:t=>m(t),1:t=>i(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(i(t)),5:t=>new Set(i(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t)},o=t=>{let[l,e]=t;return l in a?a[l](e):void 0},i=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="1MPqDn" component-url="/_astro/DarkModeButton.DO2Ui45z.js" component-export="default" renderer-url="/_astro/client.DL9GsK0T.js" props="{}" ssr="" client="only" opts="{&quot;name&quot;:&quot;DarkModeButton&quot;,&quot;value&quot;:&quot;preact&quot;}"></astro-island> </div> <button id="burger-button" aria-label="Toggle mobile menu" class="md:hidden block w-14 h-14 relative focus:outline-none rounded z-10"> <div class="block w-5 absolute left-6 top-1/2 transform -translate-x-1/2 -translate-y-1/2"> <span id="burger-line-1" class="block absolute h-0.5 w-7 text-white bg-gray-600 dark:bg-white transform transition-all duration-500 ease-in-out -top-2"></span> <span id="burger-line-2" class="block absolute h-0.5 w-7 text-white bg-gray-600 dark:bg-white transform transition-all duration-500 ease-in-out"></span> <span id="burger-line-3" class="block absolute h-0.5 w-7 text-white bg-gray-600 dark:bg-white transform transition-all duration-500 ease-in-out top-2"></span> </div> </button> </nav> <div id="menu-backdrop" class="hidden bg-gray-600 bg-opacity-95 absolute top-0 left-0 h-screen w-screen backdrop-opacity-90 items-center justify-center"> <ul class="text-white font-bold text-xl"> <li class="p-3"><a href="/">Home</a></li> <li class="p-3"><a href="/blog">Blog</a></li> <li class="p-3"><a href="/speaking">Speaking</a></li> <li class="p-3"><a href="/about">About</a></li> <li class="p-3"> <astro-island uid="lieIt" component-url="/_astro/DarkModeButton.DO2Ui45z.js" component-export="default" renderer-url="/_astro/client.DL9GsK0T.js" props="{&quot;textOnly&quot;:[0,true],&quot;className&quot;:[0,&quot;!p-0&quot;]}" ssr="" client="only" opts="{&quot;name&quot;:&quot;DarkModeButton&quot;,&quot;value&quot;:&quot;preact&quot;}"></astro-island> </li> </ul> </div> </header>  <main class="m-0 mx-auto min-h-[70vh] w-full max-w-screen-xl px-4 py-12 text-gray-500 dark:text-gray-100">  <article> <div class="hero-image"> <img src="/_astro/cover.C3kef_5h_ZLtpY7.webp" alt="Cover for Why you shouldn't pay too much attention to your code coverage" class="rounded-xl shadow-xl mx-auto h-[500px] object-cover w-full" width="1020" height="500" loading="lazy" decoding="async"> </div> <div class="container m-auto text-center"> <div class="mt-3 text-blueGreyed dark:text-gray-300"> <time datetime="2020-05-04T00:00:00.000Z"> 4 May 2020 </time>  </div> <h1 class="font-bold text-3xl dark:text-white text-center leading-none py-4 mb-2 "> Why you shouldn&#39;t pay too much attention to your code coverage </h1> <div class="pb-6"> <a href="/tags/Testing" class="mr-2 inline-block rounded-lg bg-darkBlue px-3 py-2 text-sm text-white no-underline hover:bg-blueGreyed dark:bg-blueGreyed dark:hover:bg-darkBlue"> Testing </a><a href="/tags/JavaScript" class="mr-2 inline-block rounded-lg bg-darkBlue px-3 py-2 text-sm text-white no-underline hover:bg-blueGreyed dark:bg-blueGreyed dark:hover:bg-darkBlue"> JavaScript </a>  </div> </div> <div class="m-auto w-[720px] max-w-full">  <div class="prose
  max-w-none
  dark:prose-invert
  prose-headings:underline
  prose-h2:text-2xl prose-h2:font-bold prose-h2:dark:text-mainYellow
  prose-h3:text-xl prose-h3:font-bold
  prose-p:mb-0
  prose-p:mt-4
  prose-a:underline-offset-4
  prose-a:decoration-2
  prose-a:text-gray-700 dark:prose-a:text-slate-100 hover:prose-a:text-slate-900
  prose-a:decoration-gray-300
  hover:prose-a:decoration-blue-700 dark:hover:prose-a:decoration-mainYellow
  prose-img:rounded-xl">  <p><em>Edit 25/05/2020: The title of this article has been edited.</em></p>
<p>The company I’m working for recently set a code coverage rule requirement. Although I believe tests
improve the software quality and help developers to write code with confidence, I’m strongly against
this coverage rules. I believe this metric should never be used as a target. But first, let’s
understand how code coverage works under the hood.</p>
<p><em>This article is intended for web application testing. Not for a library (open source or not).</em></p>
<h2 id="how-code-coverage-is-generated">How Code Coverage is generated</h2>
<p>Let’s take the following code:</p>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.aqfpi.css"><script type="module" src="/_astro/ec.sgewm.js"></script><figure class="frame"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA">function</span><span style="--0:#BABED8"> </span><span style="--0:#82AAFF">foo</span><span style="--0:#89DDFF">(</span><span style="--0:#BABED8;--0fs:italic">a</span><span style="--0:#89DDFF">)</span><span style="--0:#BABED8"> </span><span style="--0:#89DDFF">{</span></div><div class="ec-line"><span style="--0:#F2858B">  </span><span style="--0:#89DDFF;--0fs:italic">if</span><span style="--0:#F2858B"> (</span><span style="--0:#BABED8">a</span><span style="--0:#F2858B">) </span><span style="--0:#89DDFF">{</span></div><div class="ec-line"><span style="--0:#89DDFF">    </span><span style="--0:#9FA4BC;--0fs:italic">// do something with 'a'.</span></div><div class="ec-line"><span style="--0:#F2858B">  </span><span style="--0:#89DDFF">}</span><span style="--0:#F2858B"> </span><span style="--0:#89DDFF;--0fs:italic">else</span><span style="--0:#F2858B"> </span><span style="--0:#89DDFF">{</span></div><div class="ec-line"><span style="--0:#89DDFF">    </span><span style="--0:#9FA4BC;--0fs:italic">// do something else.</span></div><div class="ec-line"><span style="--0:#F2858B">  </span><span style="--0:#89DDFF">}</span></div><div class="ec-line"><span style="--0:#89DDFF">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="function foo(a) {  if (a) {    // do something with &#x27;a&#x27;.  } else {    // do something else.  }}"><div></div></button></div></figure></div>
<p>will be rewriten as:</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA">function</span><span style="--0:#BABED8"> </span><span style="--0:#82AAFF">foo</span><span style="--0:#89DDFF">(</span><span style="--0:#BABED8;--0fs:italic">a</span><span style="--0:#89DDFF">)</span><span style="--0:#BABED8"> </span><span style="--0:#89DDFF">{</span></div><div class="ec-line"><span style="--0:#F2858B">  </span><span style="--0:#BABED8">cov_2mofekog2n</span><span style="--0:#89DDFF">.</span><span style="--0:#BABED8">f</span><span style="--0:#F2858B">[</span><span style="--0:#F78C6C">0</span><span style="--0:#F2858B">]</span><span style="--0:#89DDFF">++</span></div><div class="ec-line"><span style="--0:#F2858B">  </span><span style="--0:#BABED8">cov_2mofekog2n</span><span style="--0:#89DDFF">.</span><span style="--0:#BABED8">s</span><span style="--0:#F2858B">[</span><span style="--0:#F78C6C">0</span><span style="--0:#F2858B">]</span><span style="--0:#89DDFF">++</span></div><div class="ec-line"><span style="--0:#F2858B">  </span><span style="--0:#89DDFF;--0fs:italic">if</span><span style="--0:#F2858B"> (</span><span style="--0:#BABED8">a</span><span style="--0:#F2858B">) </span><span style="--0:#89DDFF">{</span></div><div class="ec-line"><span style="--0:#89DDFF">    </span><span style="--0:#9FA4BC;--0fs:italic">// do something with 'a'.</span></div><div class="ec-line"><span style="--0:#F2858B">    </span><span style="--0:#BABED8">cov_2mofekog2n</span><span style="--0:#89DDFF">.</span><span style="--0:#BABED8">b</span><span style="--0:#F2858B">[</span><span style="--0:#F78C6C">0</span><span style="--0:#F2858B">][</span><span style="--0:#F78C6C">0</span><span style="--0:#F2858B">]</span><span style="--0:#89DDFF">++</span></div><div class="ec-line"><span style="--0:#F2858B">  </span><span style="--0:#89DDFF">}</span><span style="--0:#F2858B"> </span><span style="--0:#89DDFF;--0fs:italic">else</span><span style="--0:#F2858B"> </span><span style="--0:#89DDFF">{</span></div><div class="ec-line"><span style="--0:#89DDFF">    </span><span style="--0:#9FA4BC;--0fs:italic">// do something else.</span></div><div class="ec-line"><span style="--0:#F2858B">    </span><span style="--0:#BABED8">cov_2mofekog2n</span><span style="--0:#89DDFF">.</span><span style="--0:#BABED8">b</span><span style="--0:#F2858B">[</span><span style="--0:#F78C6C">0</span><span style="--0:#F2858B">][</span><span style="--0:#F78C6C">1</span><span style="--0:#F2858B">]</span><span style="--0:#89DDFF">++</span></div><div class="ec-line"><span style="--0:#F2858B">  </span><span style="--0:#89DDFF">}</span></div><div class="ec-line"><span style="--0:#89DDFF">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="function foo(a) {  cov_2mofekog2n.f[0]++  cov_2mofekog2n.s[0]++  if (a) {    // do something with &#x27;a&#x27;.    cov_2mofekog2n.b[0][0]++  } else {    // do something else.    cov_2mofekog2n.b[0][1]++  }}"><div></div></button></div></figure></div>
<p>A global counter object <code>cov_2mofekog2n</code> is created for this file. This object’s have key that stand
for:</p>
<ul>
<li><code>f</code>: function;</li>
<li><code>s</code>: statement. Note: the else belongs to the if statement. That’s why we have only one statement
here.</li>
<li><code>b</code>: branch. Note that branch 0 have 2 counter (because if and else are 2 different branches)</li>
</ul>
<p>As
<a href="https://blog.npmjs.org/post/178487845610/rethinking-javascript-test-coverage">Benjamin Coe mentioned</a>,
this way of measuring the coverage changed had now. Code coverage is now computed on Node V8’s side.
But, the idea of a global counter remains the same.</p>
<p>Now we have seen how this metric is computed, let’s see why we shouldn’t use it as a target.</p>
<h2 id="reason-1-covered-code--tested-code">Reason #1: Covered code !== tested code</h2>
<p>We can take the previous code example and add the following test.</p>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">foo.test.js</span></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#89DDFF;--0fs:italic">import</span><span style="--0:#BABED8"> foo </span><span style="--0:#89DDFF;--0fs:italic">from</span><span style="--0:#BABED8"> </span><span style="--0:#89DDFF">'</span><span style="--0:#C3E88D">./foo.js</span><span style="--0:#89DDFF">'</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#82AAFF">describe</span><span style="--0:#BABED8">(</span><span style="--0:#89DDFF">'</span><span style="--0:#C3E88D">Foo.js</span><span style="--0:#89DDFF">'</span><span style="--0:#89DDFF">,</span><span style="--0:#BABED8"> </span><span style="--0:#89DDFF">()</span><span style="--0:#BABED8"> </span><span style="--0:#C792EA">=></span><span style="--0:#BABED8"> </span><span style="--0:#89DDFF">{</span></div><div class="ec-line"><span style="--0:#F2858B">  </span><span style="--0:#82AAFF">it</span><span style="--0:#F2858B">(</span><span style="--0:#89DDFF">'</span><span style="--0:#C3E88D">should do something</span><span style="--0:#89DDFF">'</span><span style="--0:#89DDFF">,</span><span style="--0:#F2858B"> </span><span style="--0:#89DDFF">()</span><span style="--0:#F2858B"> </span><span style="--0:#C792EA">=></span><span style="--0:#F2858B"> </span><span style="--0:#89DDFF">{</span></div><div class="ec-line"><span style="--0:#F2858B">    </span><span style="--0:#82AAFF">foo</span><span style="--0:#F2858B">(</span><span style="--0:#FF9CAC">true</span><span style="--0:#F2858B">)</span></div><div class="ec-line"><span style="--0:#F2858B">    </span><span style="--0:#82AAFF">foo</span><span style="--0:#F2858B">(</span><span style="--0:#FF9CAC">false</span><span style="--0:#F2858B">)</span></div><div class="ec-line"><span style="--0:#F2858B">  </span><span style="--0:#89DDFF">}</span><span style="--0:#F2858B">)</span></div><div class="ec-line"><span style="--0:#89DDFF">}</span><span style="--0:#BABED8">)</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="import foo from &#x27;./foo.js&#x27;describe(&#x27;Foo.js&#x27;, () => {  it(&#x27;should do something&#x27;, () => {    foo(true)    foo(false)  })})"><div></div></button></div></figure></div>
<p>Now, if you run <code>npm run test -- --coverage</code>, you will get… 100% code coverage. In other words:
<strong>You don’t need any assertion to cover code</strong>.</p>
<p>The example itself might sound ridiculous because dev usually don’t write empty functions or tests
like that. Ok.</p>
<p>Let’s take a more realistic example.</p>
<div class="expressive-code"><figure class="frame has-title"><figcaption class="header"><span class="title">shop.spec.js</span></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#82AAFF">describe</span><span style="--0:#BABED8">(</span><span style="--0:#89DDFF">'</span><span style="--0:#C3E88D">Shop</span><span style="--0:#89DDFF">'</span><span style="--0:#89DDFF">,</span><span style="--0:#BABED8"> </span><span style="--0:#89DDFF">()</span><span style="--0:#BABED8"> </span><span style="--0:#C792EA">=></span><span style="--0:#BABED8"> </span><span style="--0:#89DDFF">{</span></div><div class="ec-line"><span style="--0:#F2858B">  </span><span style="--0:#82AAFF">it</span><span style="--0:#F2858B">(</span><span style="--0:#89DDFF">'</span><span style="--0:#C3E88D">should render the component</span><span style="--0:#89DDFF">'</span><span style="--0:#89DDFF">,</span><span style="--0:#F2858B"> </span><span style="--0:#89DDFF">()</span><span style="--0:#F2858B"> </span><span style="--0:#C792EA">=></span><span style="--0:#F2858B"> </span><span style="--0:#89DDFF">{</span></div><div class="ec-line"><span style="--0:#F2858B">    </span><span style="--0:#C792EA">const</span><span style="--0:#F2858B"> </span><span style="--0:#BABED8">wrapper</span><span style="--0:#F2858B"> </span><span style="--0:#89DDFF">=</span><span style="--0:#F2858B"> </span><span style="--0:#82AAFF">mount</span><span style="--0:#F2858B">(</span><span style="--0:#89DDFF">&#x3C;</span><span style="--0:#FFCB6B">Shop</span><span style="--0:#89DDFF"> />,</span><span style="--0:#F2858B"> </span><span style="--0:#89DDFF">{</span><span style="--0:#F2858B"> </span><span style="--0:#BABED8">products</span><span style="--0:#F2858B"> </span><span style="--0:#89DDFF">}</span><span style="--0:#F2858B">)</span></div><div class="ec-line"><span style="--0:#F2858B">    </span><span style="--0:#82AAFF">expect</span><span style="--0:#F2858B">(</span><span style="--0:#BABED8">wrapper</span><span style="--0:#89DDFF">.</span><span style="--0:#82AAFF">text</span><span style="--0:#F2858B">())</span><span style="--0:#89DDFF">.</span><span style="--0:#82AAFF">toMatch</span><span style="--0:#F2858B">(</span><span style="--0:#89DDFF">/</span><span style="--0:#C3E88D">Our products</span><span style="--0:#89DDFF">/</span><span style="--0:#F2858B">)</span></div><div class="ec-line"><span style="--0:#F2858B">  </span><span style="--0:#89DDFF">}</span><span style="--0:#F2858B">)</span></div><div class="ec-line"><span style="--0:#89DDFF">}</span><span style="--0:#BABED8">)</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="describe(&#x27;Shop&#x27;, () => {  it(&#x27;should render the component&#x27;, () => {    const wrapper = mount(<Shop />, { products })    expect(wrapper.text()).toMatch(/Our products/)  })})"><div></div></button></div></figure></div>
<p>With a test like this, it’s super easy to get high coverage. However, this test doesn’t test
anything related on how the product itself is rendered.</p>
<p><strong>Code coverage doesn’t give any indication of what is actually tested.</strong></p>
<h2 id="reason-2-dev-focus-on-coverage-instead-of-confidence">Reason #2: Dev focus on coverage instead of confidence</h2>
<p>If I continue with the shop example. We still have one test that tests almost nothing (but covers a
lot!). When I get the code coverage report, it says that one scenario is not tested: when one
product is available.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#82AAFF">getPageTitle</span><span style="--0:#BABED8">() </span><span style="--0:#89DDFF">{</span></div><div class="ec-line"><span style="--0:#F2858B">  </span><span style="--0:#89DDFF;--0fs:italic">return</span><span style="--0:#F2858B"> </span><span style="--0:#89DDFF">this.</span><span style="--0:#BABED8">products</span><span style="--0:#89DDFF">.</span><span style="--0:#BABED8">length</span><span style="--0:#F2858B"> </span><span style="--0:#89DDFF">===</span><span style="--0:#F2858B"> </span><span style="--0:#F78C6C">1</span></div><div class="ec-line"><span style="--0:#F2858B">    </span><span style="--0:#89DDFF">?</span><span style="--0:#F2858B"> </span><span style="--0:#89DDFF">'</span><span style="--0:#C3E88D">Our product</span><span style="--0:#89DDFF">'</span></div><div class="ec-line"><span style="--0:#F2858B">    </span><span style="--0:#89DDFF">:</span><span style="--0:#F2858B"> </span><span style="--0:#89DDFF">'</span><span style="--0:#C3E88D">Our products</span><span style="--0:#89DDFF">'</span></div><div class="ec-line"><span style="--0:#89DDFF">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="getPageTitle() {  return this.products.length === 1    ? &#x27;Our product&#x27;    : &#x27;Our products&#x27;}"><div></div></button></div></figure></div>
<p>According to you, what is the next step now?</p>
<ul>
<li>Add a test to cover this untested function? (with a low impact)</li>
<li>or reinforce tests on parts that are already covered but not tested? (with a high impact)</li>
</ul>
<p>If you are in a company with a xx% code coverage requirement, you will be more inclined to “cover”
code to bump the score.</p>
<p>We were supposed to <strong>write tests for confidence</strong>. Confidence to ship code that works as expected.
And we ends up writing tests for metrics. A nonsense!</p>
<p>Also, if you have a xx% code coverage policy, it means you’re expecting the same level of test
across the whole application. <strong>Do you think that a hidden settings page and a main feature deserves
the same attention?</strong></p>
<h2 id="reason-3-high-code-coverage--high-quality-of-tests">Reason #3: High code coverage !== high quality of tests</h2>
<blockquote>
<p>”When a measure becomes a target, it ceases to be a good measure”<br>
－ Goodhart’s law</p>
</blockquote>
<p>In one of my previous experiences, I was granted as a tech lead. I thought it could be a good idea
to set a 100% code coverage policy. I thought it was something good to enforce the code quality. I
was pretty proud to have a 100%cc and keep it over the time. And one day I got disillusioned when I
went through the code base.</p>
<p>Some dev didn’t write code for confidence but to make the CI build green. As we saw before, if you
understand how code coverage works, it’s super easy to trump this metric.</p>
<p>Here are a few example of low quality tests:</p>
<ul>
<li>
<p>a dev couldn’t test an <code>if</code> statement. So he updated the code to trump the coverage and get the
100%.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#C792EA">function</span><span style="--0:#BABED8"> </span><span style="--0:#82AAFF">myFunction</span><span style="--0:#89DDFF">(</span><span style="--0:#BABED8;--0fs:italic">something</span><span style="--0:#89DDFF">,</span><span style="--0:#BABED8"> </span><span style="--0:#BABED8;--0fs:italic">unitTest</span><span style="--0:#BABED8"> </span><span style="--0:#89DDFF">=</span><span style="--0:#BABED8"> </span><span style="--0:#FF9CAC">false</span><span style="--0:#89DDFF">)</span><span style="--0:#BABED8"> </span><span style="--0:#89DDFF">{</span></div><div class="ec-line"><span style="--0:#89DDFF">  </span><span style="--0:#9FA4BC;--0fs:italic">// code</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#F2858B">  </span><span style="--0:#89DDFF;--0fs:italic">if</span><span style="--0:#F2858B"> (</span><span style="--0:#BABED8">weirdAndHardToTestCondition</span><span style="--0:#F2858B"> </span><span style="--0:#89DDFF">||</span><span style="--0:#F2858B"> </span><span style="--0:#BABED8">unitTest</span><span style="--0:#F2858B">) </span><span style="--0:#89DDFF">{</span></div><div class="ec-line"><span style="--0:#89DDFF">    </span><span style="--0:#9FA4BC;--0fs:italic">// code</span></div><div class="ec-line"><span style="--0:#F2858B">  </span><span style="--0:#89DDFF">}</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#F2858B">  </span><span style="--0:#89DDFF;--0fs:italic">return</span><span style="--0:#F2858B"> </span><span style="--0:#BABED8">whatever</span></div><div class="ec-line"><span style="--0:#89DDFF">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="function myFunction(something, unitTest = false) {  // code  if (weirdAndHardToTestCondition || unitTest) {    // code  }  return whatever}"><div></div></button></div></figure></div>
</li>
<li>
<p><a href="/10-tips-write-better-tests#8---avoid-implementation-detail">implementation detail</a> a.k.a. tests
that result with false positives and false negatives. You have a lot of them when you search for
react/vue components on GitHub;</p>
</li>
<li>
<p>reducing code readability when code cannot be tested. Less lines of code === less uncovered
percentage. You can also write more verbose code on the covered part to gain even more percent.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#9FA4BC;--0fs:italic">// given generatePdf() is hard to test...</span></div><div class="ec-line"><span style="--0:#C792EA">const</span><span style="--0:#BABED8"> filename </span><span style="--0:#89DDFF">=</span><span style="--0:#BABED8"> </span><span style="--0:#89DDFF">`${</span><span style="--0:#BABED8">user</span><span style="--0:#89DDFF">.</span><span style="--0:#BABED8">name</span><span style="--0:#89DDFF">}</span><span style="--0:#C3E88D">-</span><span style="--0:#89DDFF">${</span><span style="--0:#BABED8">user</span><span style="--0:#89DDFF">.</span><span style="--0:#BABED8">lastname</span><span style="--0:#89DDFF">}</span><span style="--0:#C3E88D">.pdf</span><span style="--0:#89DDFF">`</span></div><div class="ec-line"><span style="--0:#C792EA">const</span><span style="--0:#BABED8"> data </span><span style="--0:#89DDFF">=</span><span style="--0:#BABED8"> </span><span style="--0:#82AAFF">formatData</span><span style="--0:#BABED8">(user</span><span style="--0:#89DDFF">.</span><span style="--0:#BABED8">data)</span></div><div class="ec-line"><span style="--0:#C792EA">const</span><span style="--0:#BABED8"> PDF </span><span style="--0:#89DDFF">=</span><span style="--0:#BABED8"> </span><span style="--0:#82AAFF">generatePdf</span><span style="--0:#BABED8">(filename</span><span style="--0:#89DDFF">,</span><span style="--0:#BABED8"> data)</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#9FA4BC;--0fs:italic">// now become</span></div><div class="ec-line"><span style="--0:#C792EA">const</span><span style="--0:#BABED8"> PDF </span><span style="--0:#89DDFF">=</span><span style="--0:#BABED8"> </span><span style="--0:#82AAFF">generatePdf</span><span style="--0:#BABED8">(</span><span style="--0:#89DDFF">`${</span><span style="--0:#BABED8">user</span><span style="--0:#89DDFF">.</span><span style="--0:#BABED8">name</span><span style="--0:#89DDFF">}</span><span style="--0:#C3E88D">-</span><span style="--0:#89DDFF">${</span><span style="--0:#BABED8">user</span><span style="--0:#89DDFF">.</span><span style="--0:#BABED8">lastname</span><span style="--0:#89DDFF">}</span><span style="--0:#C3E88D">.pdf</span><span style="--0:#89DDFF">`</span><span style="--0:#89DDFF">,</span><span style="--0:#BABED8"> </span><span style="--0:#82AAFF">formatData</span><span style="--0:#BABED8">(user</span><span style="--0:#89DDFF">.</span><span style="--0:#BABED8">data))</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="// given generatePdf() is hard to test...const filename = &#x60;${user.name}-${user.lastname}.pdf&#x60;const data = formatData(user.data)const PDF = generatePdf(filename, data)// now becomeconst PDF = generatePdf(&#x60;${user.name}-${user.lastname}.pdf&#x60;, formatData(user.data))"><div></div></button></div></figure></div>
</li>
<li>
<p>and the cherry on top: a developper extended the testing framework to test private methods. That
spicy one was in PHP (with the reflection method).</p>
</li>
</ul>
<h2 id="not-all-code-need-to-be-tested">Not all code need to be tested</h2>
<p><img  src="/_astro/effort.BCdyMpfk_ZQhzuy.webp" alt="code coverage evolution vs effort" width="796" height="558" loading="lazy" decoding="async"></p>
<p>Before giving my <a href="/speaking/#talks">talk about Frontend Testing</a>, I asked developers why they don’t
test. Without any surprises, most of them told me: <em>“we don’t have time to test”</em>. When I asked my
maker friends, I heard the same song.</p>
<p>Writing tests cost time. Therefore money.</p>
<p>Sometimes the amount of time invested on writing tests does not pay off. Because of the time
consuming aspect or because devs are flooded by too many tests.</p>
<p>That’s more or less what Kent C. Dodds explains in his famous post
<a href="https://kentcdodds.com/blog/write-tests">Write tests. Not too many. Mostly integration.</a></p>
<h2 id="wrapping-up-should-we-throw-out-the-baby-with-the-bathwater">Wrapping up: should we throw out the baby with the bathwater?</h2>
<p>Of course not!</p>
<p>Sometimes, <em>but not always</em>, Code Coverage can help to highlight untested parts of an application.
But it’s just a metric. So please, use it as a metric, as a tool to help you to take the right
decision. Not the opposite. And stop writing <em>Coverage-Driven Test™️</em> 🙏</p>
<p><strong>Using a metric as a target is a bad idea</strong>.</p>
<ul>
<li>Evaluate developers velocity with number of commit / day and they will add 30 commits per pull
request;</li>
<li>Evaluate a team velocity based on the number of lines and they will abuse from auto generated
code;</li>
<li>Evaluate a code quality with the usage of design pattern/code complexity and we will ends up with
over complicated code (you can have a look at the famous
<a href="https://github.com/EnterpriseQualityCoding/FizzBuzzEnterpriseEdition">FizzBuzzEnterpriseEdition repository</a>)</li>
<li>Evaluate a code quality with code coverage and you will ends up with all the things I mentioned
before.</li>
<li>Etc.</li>
</ul> <div> <hr> <h2 class="dark:text-gray-100">About the author</h2> <div class="flex flex-col md:flex-row items-center gap-5 md:gap-8 mt-5"> <div class="relative flex-shrink-0 h-32 w-32"> <img src="/_astro/profile-picture.CAXSHk1R_2wF1t7.webp" class="not-prose h-32 w-32 object-cover rounded-full" loading="eager" alt="Maxence Poutord" width="128" height="128" decoding="async"> </div> <div> <p class="!mt-0 pb-2">
Hey, I'm Maxence Poutord, a passionate software engineer. In my
        day-to-day job, I'm working as a senior front-end engineer at Orderfox.
        When I'm not working, you can find me travelling the world or cooking.
</p> <a class="not-prose inline-flex rounded border
    font-semibold no-underline
    transition-colors duration-200 ease-in-out px-3 py-2
    border-[#1da1f2] bg-[#1da1f2] text-white
    hover:border-[#1da1f2] hover:bg-white hover:text-[#1da1f2]" rel="noopener" target="_blank" href="https://twitter.com/intent/follow?screen_name=_maxpou"> <svg role="img" aria-label="Twitter" viewBox="0 0 24 24" width="1em" height="1em" class="h-6 w-6 pr-2"><path fill="currentColor" d="M23.954 4.569a10 10 0 0 1-2.825.775 4.958 4.958 0 0 0 2.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 0 0-8.384 4.482C7.691 8.094 4.066 6.13 1.64 3.161a4.822 4.822 0 0 0-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 0 1-2.228-.616v.061a4.923 4.923 0 0 0 3.946 4.827 4.996 4.996 0 0 1-2.212.085 4.937 4.937 0 0 0 4.604 3.417 9.868 9.868 0 0 1-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 0 0 7.557 2.209c9.054 0 13.999-7.496 13.999-13.986 0-.209 0-.42-.015-.63a9.936 9.936 0 0 0 2.46-2.548l-.047-.02z"></path></svg>
Follow @_maxpou
 </a> </div> </div> </div>  </div>  <div> <h2 class="text-2xl underline mt-12 font-bold dark:text-mainYellow">
Recommended posts
</h2> <div class="grid grid-cols-1 gap-4 md:grid-cols-2 mt-6"> <a title="Git: Cheat Sheet (advanced)" href="/blog/git-cheat-sheet/" class="ease flex flex-col rounded-lg bg-white transition duration-300 dark:bg-gray-500 hover:translate-y-0.5 shadow-md  hover:shadow-xl group"> <picture> <source srcset="/_astro/git-toolbox.CgO6v5Gs_ZJspTf.webp" type="image/webp"><source srcset="/_astro/git-toolbox.CgO6v5Gs_95POL.avif" type="image/avif"><source srcset="/_astro/git-toolbox.CgO6v5Gs_Z1ljwFa.jpeg" type="image/jpeg"> <img src="/_astro/git-toolbox.CgO6v5Gs_ZSYVDN.png" alt="Cover for post Git: Cheat Sheet (advanced)" class="h-56 w-full rounded-b-none rounded-t-lg object-cover transition" width="420" height="224" loading="lazy" decoding="async"> </picture> <div class="p-4"> <header class="text-xl font-semibold text-gray-700 dark:text-gray-100"> <span class="inline">  <!-- {post.data.title} --> <span class="from-blue-100 to-blue-100 text-dark dark:bg-none
           bg-gradient-to-r bg-[length:0px_10px] bg-left-bottom bg-no-repeat transition-[background-size] duration-500 hover:bg-[length:100%_3px] group-hover:bg-[length:100%_10px]"> Git: Cheat Sheet (advanced) </span> </span> </header> <p class="date text-gray-400 dark:text-gray-100"> <time datetime="2019-11-28T00:00:00.000Z"> 28 November 2019 </time> </p> </div> </a><a title="Vue.js Testing Made it Easy (with Testing Library)" href="/blog/vue-js-testing-library/" class="ease flex flex-col rounded-lg bg-white transition duration-300 dark:bg-gray-500 hover:translate-y-0.5 shadow-md  hover:shadow-xl group"> <picture> <source srcset="/_astro/cover.FA1DSgeP_Zpwefq.webp" type="image/webp"><source srcset="/_astro/cover.FA1DSgeP_Z1HRvXP.avif" type="image/avif"><source srcset="/_astro/cover.FA1DSgeP_Z1IBH83.jpeg" type="image/jpeg"> <img src="/_astro/cover.FA1DSgeP_LJGrw.jpg" alt="Cover for post Vue.js Testing Made it Easy (with Testing Library)" class="h-56 w-full rounded-b-none rounded-t-lg object-cover transition" width="420" height="224" loading="lazy" decoding="async"> </picture> <div class="p-4"> <header class="text-xl font-semibold text-gray-700 dark:text-gray-100"> <span class="inline">  <!-- {post.data.title} --> <span class="from-blue-100 to-blue-100 text-dark dark:bg-none
           bg-gradient-to-r bg-[length:0px_10px] bg-left-bottom bg-no-repeat transition-[background-size] duration-500 hover:bg-[length:100%_3px] group-hover:bg-[length:100%_10px]"> Vue.js Testing Made it Easy (with Testing Library) </span> </span> </header> <p class="date text-gray-400 dark:text-gray-100"> <time datetime="2020-06-11T00:00:00.000Z"> 11 June 2020 </time> </p> </div> </a> </div> </div>  </div> </article>  </main> <footer class="bg-blue-50 dark:bg-gray-600 dark:text-white w-full mx-auto pb-0" data-astro-cid-sz7xmlte> <div class="m-auto flex w-[1024px] max-w-full flex-wrap justify-between" data-astro-cid-sz7xmlte> <div class="w-full pb-4 md:w-auto flex-auto" data-astro-cid-sz7xmlte> <p class="pb-1 font-bold" data-astro-cid-sz7xmlte>
&copy; 2014 - 2024 - Maxence Poutord </p> <p data-astro-cid-sz7xmlte>Built with Astro, Tailwind and some ☕️</p> <p data-astro-cid-sz7xmlte>
Hosted with <span class="text-red-500" data-astro-cid-sz7xmlte>❤</span> by <a class="hover:text-gray-700 hover:underline dark:hover:text-mainYellow" href="https://github.com/maxpou/maxpou.fr" data-astro-cid-sz7xmlte>GitHub</a>.
</p> </div> <div class="flex-auto" data-astro-cid-sz7xmlte> <h3 class="pb-1 font-bold" data-astro-cid-sz7xmlte>Explore</h3> <ul data-astro-cid-sz7xmlte> <li data-astro-cid-sz7xmlte> <a href="/uses" target="_self" class="hover:text-gray-700 hover:underline dark:hover:text-mainYellow" data-astro-cid-sz7xmlte> Uses </a> </li><li data-astro-cid-sz7xmlte> <a href="/recipes" target="_self" class="hover:text-gray-700 hover:underline dark:hover:text-mainYellow" data-astro-cid-sz7xmlte> Recipes (kitchen) </a> </li><li data-astro-cid-sz7xmlte> <a href="/about" target="_self" class="hover:text-gray-700 hover:underline dark:hover:text-mainYellow" data-astro-cid-sz7xmlte> About </a> </li><li data-astro-cid-sz7xmlte> <a href="/cv" target="_blank" class="hover:text-gray-700 hover:underline dark:hover:text-mainYellow" data-astro-cid-sz7xmlte> Resume (cv) </a> </li><li data-astro-cid-sz7xmlte> <a href="/readme" target="_self" class="hover:text-gray-700 hover:underline dark:hover:text-mainYellow" data-astro-cid-sz7xmlte> Readme </a> </li> </ul> </div> <div class="flex-auto" data-astro-cid-sz7xmlte> <h3 class="pb-1 font-bold flex-auto" data-astro-cid-sz7xmlte>Let's connect</h3> <ul data-astro-cid-sz7xmlte> <li data-astro-cid-sz7xmlte> <a href="https://github.com/maxpou" rel="noopener noreferrer" class="hover:text-gray-700 hover:underline dark:hover:text-mainYellow" data-astro-cid-sz7xmlte> GitHub </a> </li><li data-astro-cid-sz7xmlte> <a href="https://twitter.com/_maxpou" rel="noopener noreferrer" class="hover:text-gray-700 hover:underline dark:hover:text-mainYellow" data-astro-cid-sz7xmlte> Twitter </a> </li><li data-astro-cid-sz7xmlte> <a href="https://www.linkedin.com/in/maxpou/" rel="noopener noreferrer" class="hover:text-gray-700 hover:underline dark:hover:text-mainYellow" data-astro-cid-sz7xmlte> LinkedIn </a> </li><li data-astro-cid-sz7xmlte> <a href="/rss.xml" class="hover:text-gray-700 hover:underline dark:hover:text-mainYellow" data-astro-cid-sz7xmlte> RSS feed </a> </li> </ul> </div> </div>  </footer>  </body> </html>