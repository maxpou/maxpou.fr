<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Astro v4.4.0"><!-- Font preloads --><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Lato:400,700&display=swap"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700&display=swap" media="print" onload="this.media='all'"><!-- Canonical URL --><link rel="canonical" href="https://www.maxpou.fr/blog/rest-crud/"><!-- Primary Meta Tags --><title>REST, CRUD et bonnes pratiques</title><meta name="title" content="REST, CRUD et bonnes pratiques"><meta name="description" content="Guide de bonnes pratiques pour les API REST CRUD"><script async defer data-domain="maxpou.fr" src="https://plausible.io/js/plausible.js"></script><link rel="alternate" type="application/rss+xml" title="Maxence Poutord • Maxpou Blog" href="/rss.xml"><link rel="sitemap" type="application/xml" href="/sitemap-index.xml"><!-- Open Graph / Facebook --><meta property="og:type" content="article"><meta property="og:url" content="https://www.maxpou.fr/blog/rest-crud/"><meta property="og:title" content="REST, CRUD et bonnes pratiques"><meta property="og:description" content="Guide de bonnes pratiques pour les API REST CRUD"><meta property="og:image" content="https://www.maxpou.fr/og/rest-crud.png"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://www.maxpou.fr/blog/rest-crud/"><meta property="twitter:title" content="REST, CRUD et bonnes pratiques"><meta property="twitter:description" content="Guide de bonnes pratiques pour les API REST CRUD"><meta name="twitter:creator" content="_maxpou"><meta property="twitter:image" content="https://www.maxpou.fr/og/rest-crud.png"><script>
  const theme = (() => {
    if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
      return localStorage.getItem('theme')
    }
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
      return 'dark'
    }
    return 'light'
  })()

  if (theme === 'light') {
    document.documentElement.classList.remove('dark')
  } else {
    document.documentElement.classList.add('dark')
  }
  window.localStorage.setItem('theme', theme)
</script><link rel="stylesheet" href="/_astro/_slug_.FJDvWzr3.css" />
<style>code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.comment,.token.block-comment,.token.prolog,.token.doctype,.token.cdata{color:#999}.token.punctuation{color:#ccc}.token.tag,.token.attr-name,.token.namespace,.token.deleted{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.number,.token.function{color:#f08d49}.token.property,.token.class-name,.token.constant,.token.symbol{color:#f8c555}.token.selector,.token.important,.token.atrule,.token.keyword,.token.builtin{color:#cc99cd}.token.string,.token.char,.token.attr-value,.token.regex,.token.variable{color:#7ec699}.token.operator,.token.entity,.token.url{color:#67cdcc}.token.important,.token.bold{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}.expressive-code{margin-top:1em}
</style>
<link rel="stylesheet" href="/_astro/_slug_.rgG313J3.css" />
<style>a[data-astro-cid-eimmu3lg]{display:inline-block;text-decoration:none;border-bottom:4px solid transparent}a[data-astro-cid-eimmu3lg].active{font-weight:bolder;border-bottom-color:#ffdc4e}footer[data-astro-cid-sz7xmlte]{padding:2em 1em 6em;color:rgb(var(--gray))}*{transition:background .5s ease}*::-moz-selection{background-color:#ffdc4e;color:#3e4047}*::selection{background-color:#ffdc4e;color:#3e4047}
</style><script type="module">const n=document.getElementById("burger-button"),e=document.getElementById("burger-line-1"),r=document.getElementById("burger-line-2"),t=document.getElementById("burger-line-3"),o=document.getElementById("menu-backdrop");n.addEventListener("click",()=>{o.classList.contains("hidden")?(o.classList.add("flex"),o.classList.remove("hidden"),e.style.transform="rotate(45deg)",e.style.top="0",e.style.backgroundColor="white",r.style.backgroundColor="transparent",t.style.transform="rotate(-45deg)",t.style.top="0",t.style.backgroundColor="white"):(e.style.transform="rotate(0)",e.style.removeProperty("top"),e.style.removeProperty("background-color"),r.style.removeProperty("background-color"),t.style.removeProperty("background-color"),t.style.transform="rotate(0)",t.style.removeProperty("top"),o.classList.add("hidden"),o.classList.remove("flex"))});
</script></head> <body class="bg-gradient-to-b from-blue-50 to-[#f5f7f9] dark:bg-gray-600 dark:bg-gradient-to-b dark:from-gray-600"> <header class="bg-white dark:bg-gray-600 px-4 h-16"> <nav class="dark:text-white h-16 flex items-center justify-between max-w-screen-xl w-full mx-auto"> <h1 class="text-lg dark:text-white font-bold"> <a href="/">Maxence Poutord</a> </h1> <div class="md:flex hidden"> <a href="/blog" class="py-4 px-2 no-underline text-lg hover:text-blue-900 dark:text-white dark:hover:text-mainYellow" data-astro-cid-eimmu3lg> Blog </a>  <a href="/speaking" class="py-4 px-2 no-underline text-lg hover:text-blue-900 dark:text-white dark:hover:text-mainYellow" data-astro-cid-eimmu3lg> Speaking </a>  <a href="/about" class="py-4 px-2 no-underline text-lg hover:text-blue-900 dark:text-white dark:hover:text-mainYellow" data-astro-cid-eimmu3lg> About </a>  <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).only=e;window.dispatchEvent(new Event("astro:only"));})();;(()=>{var v=Object.defineProperty;var A=(c,s,a)=>s in c?v(c,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):c[s]=a;var d=(c,s,a)=>(A(c,typeof s!="symbol"?s+"":s,a),a);var u;{let c={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t)},s=t=>{let[e,n]=t;return e in c?c[e](n):void 0},a=t=>t.map(s),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([e,n])=>[e,s(n)]));customElements.get("astro-island")||customElements.define("astro-island",(u=class extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var f;if(!this.hydrator||!this.isConnected)return;let e=(f=this.parentElement)==null?void 0:f.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let n=this.querySelectorAll("astro-slot"),r={},l=this.querySelectorAll("template[data-astro-template]");for(let o of l){let i=o.closest(this.tagName);i!=null&&i.isSameNode(this)&&(r[o.getAttribute("data-astro-template")||"default"]=o.innerHTML,o.remove())}for(let o of n){let i=o.closest(this.tagName);i!=null&&i.isSameNode(this)&&(r[o.getAttribute("name")||"default"]=o.innerHTML)}let h;try{h=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(o){let i=this.getAttribute("component-url")||"<unknown>",b=this.getAttribute("component-export");throw b&&(i+=` (export ${b})`),console.error(`[hydrate] Error parsing props for component ${i}`,this.getAttribute("props"),o),o}let p;await this.hydrator(this)(this.Component,h,r,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),n.disconnect(),this.childrenConnectedCallback()},n=new MutationObserver(()=>{var r;((r=this.lastChild)==null?void 0:r.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});n.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),n=this.getAttribute("client");if(Astro[n]===void 0){window.addEventListener(`astro:${n}`,()=>this.start(),{once:!0});return}try{await Astro[n](async()=>{let r=this.getAttribute("renderer-url"),[l,{default:h}]=await Promise.all([import(this.getAttribute("component-url")),r?import(r):()=>()=>{}]),p=this.getAttribute("component-export")||"default";if(!p.includes("."))this.Component=l[p];else{this.Component=l;for(let y of p.split("."))this.Component=this.Component[y]}return this.hydrator=h,this.hydrate},e,this)}catch(r){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,r)}}attributeChangedCallback(){this.hydrate()}},d(u,"observedAttributes",["props"]),u))}})();</script><astro-island uid="1MPqDn" component-url="/_astro/DarkModeButton.xNbp8Br3.js" component-export="default" renderer-url="/_astro/client.PcUt3MZx.js" props="{}" ssr="" client="only" opts="{&quot;name&quot;:&quot;DarkModeButton&quot;,&quot;value&quot;:&quot;preact&quot;}"></astro-island> </div> <button id="burger-button" aria-label="Toggle mobile menu" class="md:hidden block w-14 h-14 relative focus:outline-none rounded z-10"> <div class="block w-5 absolute left-6 top-1/2 transform -translate-x-1/2 -translate-y-1/2"> <span id="burger-line-1" class="block absolute h-0.5 w-7 text-white bg-gray-600 dark:bg-white transform transition-all duration-500 ease-in-out -top-2"></span> <span id="burger-line-2" class="block absolute h-0.5 w-7 text-white bg-gray-600 dark:bg-white transform transition-all duration-500 ease-in-out"></span> <span id="burger-line-3" class="block absolute h-0.5 w-7 text-white bg-gray-600 dark:bg-white transform transition-all duration-500 ease-in-out top-2"></span> </div> </button> </nav> <div id="menu-backdrop" class="hidden bg-gray-600 bg-opacity-95 absolute top-0 left-0 h-screen w-screen backdrop-opacity-90 items-center justify-center"> <ul class="text-white font-bold text-xl"> <li class="p-3"><a href="/">Home</a></li> <li class="p-3"><a href="/blog">Blog</a></li> <li class="p-3"><a href="/speaking">Speaking</a></li> <li class="p-3"><a href="/about">About</a></li> <li class="p-3"> <astro-island uid="lieIt" component-url="/_astro/DarkModeButton.xNbp8Br3.js" component-export="default" renderer-url="/_astro/client.PcUt3MZx.js" props="{&quot;textOnly&quot;:[0,true],&quot;className&quot;:[0,&quot;!p-0&quot;]}" ssr="" client="only" opts="{&quot;name&quot;:&quot;DarkModeButton&quot;,&quot;value&quot;:&quot;preact&quot;}"></astro-island> </li> </ul> </div> </header>  <main class="m-0 mx-auto min-h-[70vh] w-full max-w-screen-xl px-4 py-12 text-gray-500 dark:text-gray-100">  <article> <div class="hero-image"> <img src="/_astro/abstract-5.m8hticRR_2k8UuN.webp" alt="Cover picture for REST, CRUD et bonnes pratiques" class="rounded-xl shadow-xl mx-auto h-[500px] object-cover w-full" width="1020" height="500" loading="lazy" decoding="async"> </div> <div class="container m-auto text-center"> <div class="mt-3 text-blueGreyed dark:text-gray-300"> <time datetime="2015-09-15T00:00:00.000Z"> 15 September 2015 </time>  </div> <h1 class="font-bold text-3xl dark:text-white text-center leading-none py-4 mb-2 "> REST, CRUD et bonnes pratiques </h1> <div class="pb-6"> <a href="/tags/REST" class="mr-2 inline-block rounded-lg bg-darkBlue px-3 py-2 text-sm text-white no-underline hover:bg-blueGreyed dark:bg-blueGreyed dark:hover:bg-darkBlue"> REST </a><a href="/tags/HTTP" class="mr-2 inline-block rounded-lg bg-darkBlue px-3 py-2 text-sm text-white no-underline hover:bg-blueGreyed dark:bg-blueGreyed dark:hover:bg-darkBlue"> HTTP </a>  </div> </div> <div class="m-auto w-[720px] max-w-full">  <div class="prose
  max-w-none
  dark:prose-invert
  prose-headings:underline
  prose-h2:text-2xl prose-h2:font-bold prose-h2:dark:text-mainYellow
  prose-h3:text-xl prose-h3:font-bold
  prose-p:mb-0
  prose-p:mt-4
  prose-a:underline-offset-4
  prose-a:decoration-2
  prose-a:text-gray-700 dark:prose-a:text-slate-100 hover:prose-a:text-slate-900
  prose-a:decoration-gray-300
  hover:prose-a:decoration-blue-700 dark:hover:prose-a:decoration-mainYellow
  prose-img:rounded-xl">  <h2 id="bref-rappel-des-méthodes-http">Bref rappel des méthodes HTTP</h2>
<p>Pour rappel, voici les principaux verbes HTTP que nous utilisons pour des architectures REST :</p>
<ul>
<li>GET : Accède à une ressource</li>
<li>HEAD : Accède aux métadonnées d’une ressource</li>
<li>POST : Ajoute une ressource</li>
<li>PUT : Met à jour une ressource <strong>complète</strong> en la remplaçant par une nouvelle version (99% des
cas).</li>
<li>PATCH : Met à jour une partie d’une ressource en envoyant un différentiel (une sorte de ‘git
diff’)</li>
<li>DELETE : Supprime une ressource</li>
</ul>
<h2 id="méthodes-safes-sûres-et-idempotents-idempotentes">Méthodes safes (sûres) et idempotents (idempotentes)</h2>
<p>La <a href="http://tools.ietf.org/html/rfc7231#section-4.2">RFC7231</a> (remplaçante de la RFC2616) a ajouté
deux notions aux méthodes HTTP :</p>
<ul>
<li>Les méthodes dites <strong>safes</strong> ne modifient pas les données sur le serveur. Peu importe le nombre de
fois qu’elles sont appelées.</li>
<li>Les méthodes <strong>idempotents</strong> quant à elles <em>peuvent</em> modifier les données lors du premier appel.
Lors des appels suivants, la réponse sera tout le temps identique. En cas de panne/problème
réseau, vous pourrez donc lancer la requête sans craintes puisque le comportement est le même que
vous exécutiez la requête une ou plusieurs fois.</li>
</ul>
<p>Méthode | Safe | Idempotente GET | Oui | Oui HEAD | Oui | Oui POST | Non | Non PUT | Non | Oui PATCH
| Non | Non DELETE | Non | Oui</p>
<p><strong>Focus sur le DELETE :</strong> On serait tenté de dire que DELETE n’est pas idempotent car on ne peut pas
supprimer deux fois le même objet. Ceci étant, si l’on regarde la RFC, DELETE doit bien retourner un
code 200 (Success) en cas de réussite et non pas un 204 (No Content). Si l’API n’a pas été bien
conçue et qu’elle renvoie un 404 (Not Found), alors le DELETE ne sera plus idempotent comme elle
devrait l’être.</p>
<h2 id="cachabilité">Cachabilité</h2>
<blockquote>
<p>”La requête la plus performante est celle que l’on a pas à faire !”<br>
— <strong>Un inconnu</strong></p>
</blockquote>
<p>La mise en cache est l’une des contraintes les plus importantes des architectures web. En effet,
elle permet de :</p>
<ul>
<li>décharger votre serveur en lui évitant de refaire la même chose deux fois,</li>
<li>réduire le temps de traitement d’une requête,</li>
<li>…et donc de renvoyer plus rapidement l’information au client.</li>
</ul>
<p>Les méthodes dites <strong>safes</strong> sont donc à mettre en cache !</p>
<h2 id="bonnesmauvaises-pratiques">Bonnes/mauvaises pratiques</h2>
<p>Il y a malheureusement, trop d’API conçue comme ceci :</p>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.aqfpi.css"><script type="module" src="/_astro/ec.sgewm.js"></script><figure class="frame"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#babed8">POST api.mon-application.org/utilisateurs/rechercher</span></div><div class="ec-line"><span style="--0:#babed8">POST api.mon-application.org/utilisateurs/42/supprimer</span></div><div class="ec-line"><span style="--0:#babed8">POST api.mon-application.org/utilisateurs/42/modifier</span></div><div class="ec-line"><span style="--0:#babed8">GET api.mon-application.org/utilisateurs/supprimer?id=42</span></div><div class="ec-line"><span style="--0:#babed8">GET api.mon-application.org/utilisateurs/42?action=supprimer</span></div><div class="ec-line"><span style="--0:#babed8">GET api.mon-application.org/utilisateurs/42?action=envoyerMailConfirmation</span></div><div class="ec-line"><span style="--0:#babed8">...</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="POST api.mon-application.org/utilisateurs/rechercherPOST api.mon-application.org/utilisateurs/42/supprimerPOST api.mon-application.org/utilisateurs/42/modifierGET api.mon-application.org/utilisateurs/supprimer?id=42GET api.mon-application.org/utilisateurs/42?action=supprimerGET api.mon-application.org/utilisateurs/42?action=envoyerMailConfirmation..."><div></div></button></div></figure></div>
<p>Ce sont de mauvaises pratiques liées à une mauvaise compréhension des verbes HTTP. Quand il y a un
nom d’action CRUD dans l’URI c’est qu’il y a un problème. De plus, dans la partie précédente, je
parle de cachabilité. Si vous faites une recherche avec POST, le serveur n’utilisera pas le cache…
mais il le mettra peut-être à jour (pour d’éventuels GET à venir qui ne viendront jamais).<br>
Si vous utilisez un POST au lieu d’un PUT (ou autre méthode idempotent) et que par mégarde, vous
exécutez cet appel plusieurs fois, il peut y avoir des effets de bords non désirés.</p>
<h2 id="création-post-vs-put">Création POST vs. PUT</h2>
<p>Lors d’une création de ressource, il y a deux cas de figure : le serveur a la main sur la génération
de l’id (ou du nom de la ressource) ou bien le cas contraire. Dans le premier cas, il faut
privilégier le POST et dans l’autre le PUT. En d’autres termes, n’utilisez PUT pour la création
uniquement si c’est au client connait l’URI de la ressource à créer.</p>
<p>Exemple avec les ressources subordonnées.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#89DDFF">{</span></div><div class="ec-line"><span style="--0:#F2858B">  </span><span style="--0:#89DDFF">"</span><span style="--0:#C3E88D">id</span><span style="--0:#89DDFF">"</span><span style="--0:#F2858B">: </span><span style="--0:#89DDFF">"</span><span style="--0:#C3E88D">42</span><span style="--0:#89DDFF">"</span><span style="--0:#89DDFF">,</span></div><div class="ec-line"><span style="--0:#F2858B">  </span><span style="--0:#89DDFF">"</span><span style="--0:#C3E88D">name</span><span style="--0:#89DDFF">"</span><span style="--0:#F2858B">: </span><span style="--0:#89DDFF">"</span><span style="--0:#C3E88D">calzone</span><span style="--0:#89DDFF">"</span><span style="--0:#89DDFF">,</span></div><div class="ec-line"><span style="--0:#F2858B">  </span><span style="--0:#89DDFF">"</span><span style="--0:#C3E88D">price</span><span style="--0:#89DDFF">"</span><span style="--0:#F2858B">: </span><span style="--0:#89DDFF">"</span><span style="--0:#C3E88D">$12</span><span style="--0:#89DDFF">"</span><span style="--0:#89DDFF">,</span></div><div class="ec-line"><span style="--0:#F2858B">  </span><span style="--0:#89DDFF">"</span><span style="--0:#C3E88D">ingredients</span><span style="--0:#89DDFF">"</span><span style="--0:#F2858B">: [</span></div><div class="ec-line"><span style="--0:#F2858B">    </span><span style="--0:#89DDFF">{</span><span style="--0:#F2858B"> </span><span style="--0:#89DDFF">"</span><span style="--0:#F2858B">id</span><span style="--0:#89DDFF">"</span><span style="--0:#89DDFF">:</span><span style="--0:#F2858B"> </span><span style="--0:#89DDFF">"</span><span style="--0:#C3E88D">4</span><span style="--0:#89DDFF">"</span><span style="--0:#89DDFF">,</span><span style="--0:#F2858B"> </span><span style="--0:#89DDFF">"</span><span style="--0:#F2858B">name</span><span style="--0:#89DDFF">"</span><span style="--0:#89DDFF">:</span><span style="--0:#F2858B"> </span><span style="--0:#89DDFF">"</span><span style="--0:#C3E88D">tomato sauce</span><span style="--0:#89DDFF">"</span><span style="--0:#F2858B"> </span><span style="--0:#89DDFF">}</span></div><div class="ec-line"><span style="--0:#F2858B">    </span><span style="--0:#89DDFF">{</span><span style="--0:#F2858B"> </span><span style="--0:#89DDFF">"</span><span style="--0:#F2858B">id</span><span style="--0:#89DDFF">"</span><span style="--0:#89DDFF">:</span><span style="--0:#F2858B"> </span><span style="--0:#89DDFF">"</span><span style="--0:#C3E88D">8</span><span style="--0:#89DDFF">"</span><span style="--0:#89DDFF">,</span><span style="--0:#F2858B"> </span><span style="--0:#89DDFF">"</span><span style="--0:#F2858B">name</span><span style="--0:#89DDFF">"</span><span style="--0:#89DDFF">:</span><span style="--0:#F2858B"> </span><span style="--0:#89DDFF">"</span><span style="--0:#C3E88D">ham</span><span style="--0:#89DDFF">"</span><span style="--0:#F2858B"> </span><span style="--0:#89DDFF">},</span></div><div class="ec-line"><span style="--0:#F2858B">    </span><span style="--0:#89DDFF">{</span><span style="--0:#F2858B"> </span><span style="--0:#89DDFF">"</span><span style="--0:#F2858B">id</span><span style="--0:#89DDFF">"</span><span style="--0:#89DDFF">:</span><span style="--0:#F2858B"> </span><span style="--0:#89DDFF">"</span><span style="--0:#C3E88D">15</span><span style="--0:#89DDFF">"</span><span style="--0:#89DDFF">,</span><span style="--0:#F2858B"> </span><span style="--0:#89DDFF">"</span><span style="--0:#F2858B">name</span><span style="--0:#89DDFF">"</span><span style="--0:#89DDFF">:</span><span style="--0:#F2858B"> </span><span style="--0:#89DDFF">"</span><span style="--0:#C3E88D">egg</span><span style="--0:#89DDFF">"</span><span style="--0:#F2858B"> </span><span style="--0:#89DDFF">},</span></div><div class="ec-line"><span style="--0:#F2858B">    </span><span style="--0:#89DDFF">{</span><span style="--0:#F2858B"> </span><span style="--0:#89DDFF">"</span><span style="--0:#F2858B">id</span><span style="--0:#89DDFF">"</span><span style="--0:#89DDFF">:</span><span style="--0:#F2858B"> </span><span style="--0:#89DDFF">"</span><span style="--0:#C3E88D">16</span><span style="--0:#89DDFF">"</span><span style="--0:#89DDFF">,</span><span style="--0:#F2858B"> </span><span style="--0:#89DDFF">"</span><span style="--0:#F2858B">name</span><span style="--0:#89DDFF">"</span><span style="--0:#89DDFF">:</span><span style="--0:#F2858B"> </span><span style="--0:#89DDFF">"</span><span style="--0:#C3E88D">basil leaves</span><span style="--0:#89DDFF">"</span><span style="--0:#F2858B"> </span><span style="--0:#89DDFF">}</span></div><div class="ec-line"><span style="--0:#F2858B">    </span><span style="--0:#89DDFF">...</span></div><div class="ec-line"><span style="--0:#F2858B">  ]</span></div><div class="ec-line"><span style="--0:#89DDFF">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="{  &#x22;id&#x22;: &#x22;42&#x22;,  &#x22;name&#x22;: &#x22;calzone&#x22;,  &#x22;price&#x22;: &#x22;$12&#x22;,  &#x22;ingredients&#x22;: [    { &#x22;id&#x22;: &#x22;4&#x22;, &#x22;name&#x22;: &#x22;tomato sauce&#x22; }    { &#x22;id&#x22;: &#x22;8&#x22;, &#x22;name&#x22;: &#x22;ham&#x22; },    { &#x22;id&#x22;: &#x22;15&#x22;, &#x22;name&#x22;: &#x22;egg&#x22; },    { &#x22;id&#x22;: &#x22;16&#x22;, &#x22;name&#x22;: &#x22;basil leaves&#x22; }    ...  ]}"><div></div></button></div></figure></div>
<p>Nous avons une ressource comme celle ci-dessus et que nous voulons ajouter un ingrédient. Il
pourrait-être tentant de faire un PUT sur la ressource entière. Pourtant un ingrédient est… aussi
une ressource ! Il faudra donc faire :</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#babed8">PUT http://api.example.com/pizzas/calzone/ingredients/&#x3C;idIngredient></span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="PUT http://api.example.com/pizzas/calzone/ingredients/<idIngredient>"><div></div></button></div></figure></div>
<p>En effet, ici POST pas possible car un ingrédient peut se retrouver dans plusieurs pizzas. Dans le
cas contraire, un POST aurait été utilisé comme ceci :</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#babed8">POST http://api.example.com/pizzas/calzone/ingredients/</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="POST http://api.example.com/pizzas/calzone/ingredients/"><div></div></button></div></figure></div>
<h2 id="le-cas-des-modifications-partielles">Le cas des modifications partielles</h2>
<p>Si on regarde le panel de méthodes HTTP, on voit qu’il y a deux méthodes pour modifier une ressource
: PUT et PATCH. Si vous vous souvenez bien GET requière une ressource entière et PATCH effectue un
différentiel (avec les anciennes données). Donc dans les deux cas vous êtes obligés de faire un GET
avant.</p>
<p>Là, je vous vois venir :</p>
<blockquote>
<p>“On a qu’à faire un PUT partiel et puis c’est tout !”</p>
</blockquote>
<p>Et bien non ! Comme le dit si bien le papa de REST, un PUT partiel n’est pas compatible avec une API
RESTful. Par extension, il en va de même pour le POST partiel.</p>
<blockquote class="twitter-tweet" lang="fr"><p lang="en" dir="ltr"><a href="https://twitter.com/mnot">@mnot</a> Oy, yes, PATCH was something I created for the initial HTTP/1.1 proposal because partial PUT is never RESTful. ;-)</p>— Roy T. Fielding (@fielding) <a href="https://twitter.com/fielding/status/275471320685367296">3 Décembre 2012</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>Bref, c’est toujours le même problème qui revient : <strong>Théorie Vs. Pragmatisme</strong> :</p>
<ul>
<li>Soit vous collez à fond à la spec HTTP pour avoir une vrai API REST et utilisez PATCH ;</li>
<li>Soit vous oubliez avoir lu cet article et continuez d’utiliser un POST/PUT partiel. Mais votre API
ne sera pas pleinement REST ;-)</li>
</ul>
<h2 id="sortir-du-cadre-crud">Sortir du cadre CRUD</h2>
<p>Même si ce n’est pas l’objet de cet article, je vais tout de même en parler un peu, car
contrairement à ce que certains pensent, il est possible de sortir du cadre CRUD avec une API REST.
Vous devrez alors utiliser la méthode POST, et ainsi profiter du caractère unsafe/non-idempotent de
cette dernière. Utiliser POST vous protège d’effets de bord évoqués précédemment (ex : retirer deux
fois l’argent sur le compte d’un client, double envoi de mail, …).</p>
<p>Exemple : <code>POST api.mon-application.org/utilisateurs/42/envoyer-mail-confirmation</code></p>
<p>N’oubliez pas que c’est un échange entre le client et le serveur. Par conséquent, il doit y avoir
une réponse. Réponse qui se matérialise dans le cas présent par des
<a href="http://www.restapitutorial.com/httpstatuscodes.html">codes</a>. Dans le cas présent, il faudra
renvoyer un <em>204 No Content</em>.</p>
<h2 id="sources">Sources</h2>
<ul>
<li>Si vous voulez en savoir plus sur l’utilisation de PATCH, je vous recommande cet article :
<a href="https://williamdurand.fr/2014/02/14/please-do-not-patch-like-an-idiot/">blog de William DURAND - Please do not PATCH like an idiot</a>
dédié à ce sujet.</li>
<li>J’ai récement découvert cet ouvrage :
<a href="http://shop.oreilly.com/product/0636920021575.do">REST API Design Rulebook (Mark Masse)</a>. C’est
une véritable mine d’or. Si vous vous posez des questions du type : quel code HTTP retourner ?
Quelle forme d’URL est la plus judicieuse ? Ai-je le droit de faire xxx ? … ce livre est fait
pour vous !</li>
<li>Enfin, le <a href="http://restcookbook.com">restcookbook</a> et l’article de
<a href="http://jasonsirota.com/rest-partial-updates-use-post-put-or-patch">Jason Sirota : REST Partial Updates: Use POST, PUT or PATCH?</a>
m’ont beaucoup aidé.</li>
</ul> <div> <hr> <h2 class="dark:text-gray-100">About the author</h2> <div class="flex flex-col md:flex-row items-center gap-5 md:gap-8 mt-5"> <div class="relative flex-shrink-0 h-32 w-32"> <img src="/_astro/profile-picture.gF0h5NUU_Zw8iDo.webp" class="not-prose h-32 w-32 object-cover rounded-full" alt="Maxence Poutord Profile picture" width="128" height="128" loading="lazy" decoding="async"> </div> <div> <p class="!mt-0 pb-2">
Hey, I'm Maxence Poutord, a passionate software engineer. In my
        day-to-day job, I'm working as a senior front-end engineer at Orderfox.
        When I'm not working, you can find me travelling the world or cooking.
</p> <a class="not-prose inline-flex rounded border
    font-semibold no-underline
    transition-colors duration-200 ease-in-out px-3 py-2
    border-[#1da1f2] bg-[#1da1f2] text-white
    hover:border-[#1da1f2] hover:bg-white hover:text-[#1da1f2]" rel="noopener" target="_blank" href="https://twitter.com/intent/follow?screen_name=_maxpou"> <svg aria-label="Twitter" viewBox="0 0 24 24" width="1em" height="1em" class="h-6 w-6 pr-2"><path fill="currentColor" d="M23.954 4.569a10 10 0 0 1-2.825.775 4.958 4.958 0 0 0 2.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 0 0-8.384 4.482C7.691 8.094 4.066 6.13 1.64 3.161a4.822 4.822 0 0 0-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 0 1-2.228-.616v.061a4.923 4.923 0 0 0 3.946 4.827 4.996 4.996 0 0 1-2.212.085 4.937 4.937 0 0 0 4.604 3.417 9.868 9.868 0 0 1-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 0 0 7.557 2.209c9.054 0 13.999-7.496 13.999-13.986 0-.209 0-.42-.015-.63a9.936 9.936 0 0 0 2.46-2.548l-.047-.02z"></path></svg>
Follow @_maxpou
 </a> </div> </div> </div>  </div>  <div> <h2 class="text-2xl underline mt-12 font-bold dark:text-mainYellow">
Recommended posts
</h2> <div class="grid grid-cols-1 gap-4 md:grid-cols-2 mt-6"> <a title="3 Tips for Scaling Large Vue.js Application" href="/blog/3-tips-scaling-vue-application/" class="ease flex flex-col rounded-lg bg-white transition duration-300 dark:bg-gray-500 hover:translate-y-0.5 shadow-md  hover:shadow-xl group"> <picture> <source srcset="/_astro/cover.ex1KwcGk_Z1CSi66.webp" type="image/webp"><source srcset="/_astro/cover.ex1KwcGk_1W4f23.avif" type="image/avif"><source srcset="/_astro/cover.ex1KwcGk_P1PiU.jpeg" type="image/jpeg"> <img src="/_astro/cover.ex1KwcGk_Z28Vfnj.jpg" alt="Cover picture for 3 Tips for Scaling Large Vue.js Application" class="h-56 w-full rounded-b-none rounded-t-lg object-cover transition" width="420" height="224" loading="lazy" decoding="async"> </picture> <div class="p-4"> <header class="text-xl font-semibold text-gray-700 dark:text-gray-100"> <span class="inline">  <!-- {post.data.title} --> <span class="from-blue-100 to-blue-100 text-dark dark:bg-none
           bg-gradient-to-r bg-[length:0px_10px] bg-left-bottom bg-no-repeat transition-[background-size] duration-500 hover:bg-[length:100%_3px] group-hover:bg-[length:100%_10px]"> 3 Tips for Scaling Large Vue.js Application </span> </span> </header> <p class="date text-gray-400 dark:text-gray-100"> <time datetime="2018-12-13T00:00:00.000Z"> 13 December 2018 </time> </p> </div> </a><a title="Git: Cheat Sheet (advanced)" href="/blog/git-cheat-sheet/" class="ease flex flex-col rounded-lg bg-white transition duration-300 dark:bg-gray-500 hover:translate-y-0.5 shadow-md  hover:shadow-xl group"> <picture> <source srcset="/_astro/git-toolbox.oDur-RrH_2aw0y5.webp" type="image/webp"><source srcset="/_astro/git-toolbox.oDur-RrH_Z216QvP.avif" type="image/avif"><source srcset="/_astro/git-toolbox.oDur-RrH_1yESMa.jpeg" type="image/jpeg"> <img src="/_astro/git-toolbox.oDur-RrH_20YtNw.png" alt="Cover picture for Git: Cheat Sheet (advanced)" class="h-56 w-full rounded-b-none rounded-t-lg object-cover transition" width="420" height="224" loading="lazy" decoding="async"> </picture> <div class="p-4"> <header class="text-xl font-semibold text-gray-700 dark:text-gray-100"> <span class="inline">  <!-- {post.data.title} --> <span class="from-blue-100 to-blue-100 text-dark dark:bg-none
           bg-gradient-to-r bg-[length:0px_10px] bg-left-bottom bg-no-repeat transition-[background-size] duration-500 hover:bg-[length:100%_3px] group-hover:bg-[length:100%_10px]"> Git: Cheat Sheet (advanced) </span> </span> </header> <p class="date text-gray-400 dark:text-gray-100"> <time datetime="2019-11-28T00:00:00.000Z"> 28 November 2019 </time> </p> </div> </a> </div> </div>  </div> </article>  </main> <footer class="bg-blue-50 dark:bg-gray-600 dark:text-white w-full mx-auto pb-0" data-astro-cid-sz7xmlte> <div class="m-auto flex w-[1024px] max-w-full flex-wrap justify-between" data-astro-cid-sz7xmlte> <div class="w-full pb-4 md:w-auto flex-auto" data-astro-cid-sz7xmlte> <p class="pb-1 font-bold" data-astro-cid-sz7xmlte>
&copy; 2014 - 2024 - Maxence Poutord </p> <p data-astro-cid-sz7xmlte>Built with Astro, Tailwind and some ☕️</p> <p data-astro-cid-sz7xmlte>
Hosted with <span class="text-red-500" data-astro-cid-sz7xmlte>❤</span> by <a class="hover:text-gray-700 hover:underline dark:hover:text-mainYellow" href="https://github.com/maxpou/maxpou.fr" data-astro-cid-sz7xmlte>GitHub</a>.
</p> </div> <div class="flex-auto" data-astro-cid-sz7xmlte> <h3 class="pb-1 font-bold" data-astro-cid-sz7xmlte>Explore</h3> <ul data-astro-cid-sz7xmlte> <li data-astro-cid-sz7xmlte> <a href="/uses" target="_self" class="hover:text-gray-700 hover:underline dark:hover:text-mainYellow" data-astro-cid-sz7xmlte> Uses </a> </li><li data-astro-cid-sz7xmlte> <a href="/recipes" target="_self" class="hover:text-gray-700 hover:underline dark:hover:text-mainYellow" data-astro-cid-sz7xmlte> Recipes (kitchen) </a> </li><li data-astro-cid-sz7xmlte> <a href="/about" target="_self" class="hover:text-gray-700 hover:underline dark:hover:text-mainYellow" data-astro-cid-sz7xmlte> About </a> </li><li data-astro-cid-sz7xmlte> <a href="/cv" target="_blank" class="hover:text-gray-700 hover:underline dark:hover:text-mainYellow" data-astro-cid-sz7xmlte> Resume (cv) </a> </li><li data-astro-cid-sz7xmlte> <a href="/readme" target="_self" class="hover:text-gray-700 hover:underline dark:hover:text-mainYellow" data-astro-cid-sz7xmlte> Readme </a> </li> </ul> </div> <div class="flex-auto" data-astro-cid-sz7xmlte> <h3 class="pb-1 font-bold flex-auto" data-astro-cid-sz7xmlte>Let's connect</h3> <ul data-astro-cid-sz7xmlte> <li data-astro-cid-sz7xmlte> <a href="https://github.com/maxpou" rel="noopener noreferrer" class="hover:text-gray-700 hover:underline dark:hover:text-mainYellow" data-astro-cid-sz7xmlte> GitHub </a> </li><li data-astro-cid-sz7xmlte> <a href="https://twitter.com/_maxpou" rel="noopener noreferrer" class="hover:text-gray-700 hover:underline dark:hover:text-mainYellow" data-astro-cid-sz7xmlte> Twitter </a> </li><li data-astro-cid-sz7xmlte> <a href="https://www.linkedin.com/in/maxpou/" rel="noopener noreferrer" class="hover:text-gray-700 hover:underline dark:hover:text-mainYellow" data-astro-cid-sz7xmlte> LinkedIn </a> </li><li data-astro-cid-sz7xmlte> <a href="/rss.xml" class="hover:text-gray-700 hover:underline dark:hover:text-mainYellow" data-astro-cid-sz7xmlte> RSS feed </a> </li> </ul> </div> </div>  </footer>  </body> </html>