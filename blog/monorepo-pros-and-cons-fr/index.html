<!DOCTYPE html><html lang="fr"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Astro v4.4.0"><!-- Font preloads --><link href="https://fonts.googleapis.com/css?family=Lato:400,700&display=swap" rel="stylesheet"><!-- Canonical URL --><link rel="canonical" href="https://www.maxpou.fr/blog/monorepo-pros-and-cons-fr/"><!-- Primary Meta Tags --><title>Monorepo: est-ce que ça vaut le coup?</title><meta name="title" content="Monorepo: est-ce que ça vaut le coup?"><meta name="description" content="A blog post written by Maxence Poutord"><script async defer data-domain="maxpou.fr" src="https://plausible.io/js/plausible.js"></script><link rel="alternate" type="application/rss+xml" title="Maxence Poutord • Maxpou Blog" href="/rss.xml"><link rel="sitemap" type="application/xml" href="/sitemap-index.xml"><!-- Open Graph / Facebook --><meta property="og:type" content="article"><meta property="og:url" content="https://www.maxpou.fr/blog/monorepo-pros-and-cons-fr/"><meta property="og:title" content="Monorepo: est-ce que ça vaut le coup?"><meta property="og:description" content="A blog post written by Maxence Poutord"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://www.maxpou.fr/blog/monorepo-pros-and-cons-fr/"><meta property="twitter:title" content="Monorepo: est-ce que ça vaut le coup?"><meta property="twitter:description" content="A blog post written by Maxence Poutord"><meta name="twitter:creator" content="_maxpou"><link rel="alternate" hreflang="en" href="https://www.maxpou.fr/blog/monorepo-pros-and-cons/"><link rel="alternate" hreflang="fr" href="https://www.maxpou.fr/blog/monorepo-pros-and-cons-fr/"><script>
  const theme = (() => {
    if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
      return localStorage.getItem('theme')
    }
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
      return 'dark'
    }
    return 'light'
  })()

  if (theme === 'light') {
    document.documentElement.classList.remove('dark')
  } else {
    document.documentElement.classList.add('dark')
  }
  window.localStorage.setItem('theme', theme)
</script><link rel="stylesheet" href="/_astro/_slug_.cE4nuJce.css" />
<style>code[class*=language-],pre[class*=language-]{color:#ccc;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.comment,.token.block-comment,.token.prolog,.token.doctype,.token.cdata{color:#999}.token.punctuation{color:#ccc}.token.tag,.token.attr-name,.token.namespace,.token.deleted{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.number,.token.function{color:#f08d49}.token.property,.token.class-name,.token.constant,.token.symbol{color:#f8c555}.token.selector,.token.important,.token.atrule,.token.keyword,.token.builtin{color:#cc99cd}.token.string,.token.char,.token.attr-value,.token.regex,.token.variable{color:#7ec699}.token.operator,.token.entity,.token.url{color:#67cdcc}.token.important,.token.bold{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}.expressive-code{margin-top:1em}
</style>
<link rel="stylesheet" href="/_astro/_slug_.fA4gFHjB.css" />
<style>a[data-astro-cid-eimmu3lg]{display:inline-block;text-decoration:none;border-bottom:4px solid transparent}a[data-astro-cid-eimmu3lg].active{font-weight:bolder;border-bottom-color:#ffdc4e}footer[data-astro-cid-sz7xmlte]{padding:2em 1em 6em;color:rgb(var(--gray))}*{transition:background .5s ease}*::-moz-selection{background-color:#ffdc4e;color:#3e4047}*::selection{background-color:#ffdc4e;color:#3e4047}
</style><script type="module">const n=document.getElementById("burger-button"),e=document.getElementById("burger-line-1"),r=document.getElementById("burger-line-2"),t=document.getElementById("burger-line-3"),o=document.getElementById("menu-backdrop");n.addEventListener("click",()=>{o.classList.contains("hidden")?(o.classList.add("flex"),o.classList.remove("hidden"),e.style.transform="rotate(45deg)",e.style.top="0",e.style.backgroundColor="white",r.style.backgroundColor="transparent",t.style.transform="rotate(-45deg)",t.style.top="0",t.style.backgroundColor="white"):(e.style.transform="rotate(0)",e.style.removeProperty("top"),e.style.removeProperty("background-color"),r.style.removeProperty("background-color"),t.style.removeProperty("background-color"),t.style.transform="rotate(0)",t.style.removeProperty("top"),o.classList.add("hidden"),o.classList.remove("flex"))});
</script></head> <body class="bg-gradient-to-b from-blue-50 to-[#f5f7f9] dark:bg-gray-600 dark:bg-gradient-to-b dark:from-gray-600"> <header class="bg-white dark:bg-gray-600 px-4 h-16"> <nav class="dark:text-white h-16 flex items-center justify-between max-w-screen-xl w-full mx-auto"> <h1 class="text-lg dark:text-white font-bold"> <a href="/">Maxence Poutord</a> </h1> <div class="md:flex hidden"> <a href="/blog" class="py-4 px-2 no-underline text-lg hover:text-blue-900 dark:text-white dark:hover:text-mainYellow" data-astro-cid-eimmu3lg> Blog </a>  <a href="/speaking" class="py-4 px-2 no-underline text-lg hover:text-blue-900 dark:text-white dark:hover:text-mainYellow" data-astro-cid-eimmu3lg> Speaking </a>  <a href="/about" class="py-4 px-2 no-underline text-lg hover:text-blue-900 dark:text-white dark:hover:text-mainYellow" data-astro-cid-eimmu3lg> About </a>  <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).only=e;window.dispatchEvent(new Event("astro:only"));})();;(()=>{var v=Object.defineProperty;var A=(c,s,a)=>s in c?v(c,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):c[s]=a;var d=(c,s,a)=>(A(c,typeof s!="symbol"?s+"":s,a),a);var u;{let c={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t)},s=t=>{let[e,n]=t;return e in c?c[e](n):void 0},a=t=>t.map(s),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([e,n])=>[e,s(n)]));customElements.get("astro-island")||customElements.define("astro-island",(u=class extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var f;if(!this.hydrator||!this.isConnected)return;let e=(f=this.parentElement)==null?void 0:f.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let n=this.querySelectorAll("astro-slot"),r={},l=this.querySelectorAll("template[data-astro-template]");for(let o of l){let i=o.closest(this.tagName);i!=null&&i.isSameNode(this)&&(r[o.getAttribute("data-astro-template")||"default"]=o.innerHTML,o.remove())}for(let o of n){let i=o.closest(this.tagName);i!=null&&i.isSameNode(this)&&(r[o.getAttribute("name")||"default"]=o.innerHTML)}let h;try{h=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(o){let i=this.getAttribute("component-url")||"<unknown>",b=this.getAttribute("component-export");throw b&&(i+=` (export ${b})`),console.error(`[hydrate] Error parsing props for component ${i}`,this.getAttribute("props"),o),o}let p;await this.hydrator(this)(this.Component,h,r,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),n.disconnect(),this.childrenConnectedCallback()},n=new MutationObserver(()=>{var r;((r=this.lastChild)==null?void 0:r.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});n.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),n=this.getAttribute("client");if(Astro[n]===void 0){window.addEventListener(`astro:${n}`,()=>this.start(),{once:!0});return}try{await Astro[n](async()=>{let r=this.getAttribute("renderer-url"),[l,{default:h}]=await Promise.all([import(this.getAttribute("component-url")),r?import(r):()=>()=>{}]),p=this.getAttribute("component-export")||"default";if(!p.includes("."))this.Component=l[p];else{this.Component=l;for(let y of p.split("."))this.Component=this.Component[y]}return this.hydrator=h,this.hydrate},e,this)}catch(r){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,r)}}attributeChangedCallback(){this.hydrate()}},d(u,"observedAttributes",["props"]),u))}})();</script><astro-island uid="1MPqDn" component-url="/_astro/DarkModeButton.xNbp8Br3.js" component-export="default" renderer-url="/_astro/client.PcUt3MZx.js" props="{}" ssr="" client="only" opts="{&quot;name&quot;:&quot;DarkModeButton&quot;,&quot;value&quot;:&quot;preact&quot;}"></astro-island> </div> <button id="burger-button" aria-label="Toggle mobile menu" class="md:hidden block w-14 h-14 relative focus:outline-none rounded z-10"> <div class="block w-5 absolute left-6 top-1/2 transform -translate-x-1/2 -translate-y-1/2"> <span id="burger-line-1" class="block absolute h-0.5 w-7 text-white bg-gray-600 dark:bg-white transform transition-all duration-500 ease-in-out -top-2"></span> <span id="burger-line-2" class="block absolute h-0.5 w-7 text-white bg-gray-600 dark:bg-white transform transition-all duration-500 ease-in-out"></span> <span id="burger-line-3" class="block absolute h-0.5 w-7 text-white bg-gray-600 dark:bg-white transform transition-all duration-500 ease-in-out top-2"></span> </div> </button> </nav> <div id="menu-backdrop" class="hidden bg-gray-600 bg-opacity-95 absolute top-0 left-0 h-screen w-screen backdrop-opacity-90 items-center justify-center"> <ul class="text-white font-bold text-xl"> <li class="p-3"><a href="/">Home</a></li> <li class="p-3"><a href="/blog">Blog</a></li> <li class="p-3"><a href="/speaking">Speaking</a></li> <li class="p-3"><a href="/about">About</a></li> <li class="p-3"> <astro-island uid="lieIt" component-url="/_astro/DarkModeButton.xNbp8Br3.js" component-export="default" renderer-url="/_astro/client.PcUt3MZx.js" props="{&quot;textOnly&quot;:[0,true],&quot;className&quot;:[0,&quot;!p-0&quot;]}" ssr="" client="only" opts="{&quot;name&quot;:&quot;DarkModeButton&quot;,&quot;value&quot;:&quot;preact&quot;}"></astro-island> </li> </ul> </div> </header>  <main class="m-0 mx-auto min-h-[70vh] w-full max-w-screen-xl px-4 py-12 text-gray-500 dark:text-gray-100">  <article> <div class="hero-image"> <img src="/_astro/cover.2bB88L8A_19jvDR.webp" alt="Cover picture for Monorepo: est-ce que ça vaut le coup?" class="rounded-xl shadow-xl mx-auto h-[500px] object-cover w-full" width="1020" height="500" loading="lazy" decoding="async"> </div> <div class="container m-auto text-center"> <div class="mt-3 text-blueGreyed dark:text-gray-300"> <time datetime="2020-12-22T00:00:00.000Z"> 22 December 2020 </time>  </div> <h1 class="font-bold text-3xl dark:text-white text-center leading-none py-4 mb-2 "> Monorepo: est-ce que ça vaut le coup? </h1> <div class="pb-6"> <a href="/tags/Architecture" class="mr-2 inline-block rounded-lg bg-darkBlue px-3 py-2 text-sm text-white no-underline hover:bg-blueGreyed dark:bg-blueGreyed dark:hover:bg-darkBlue"> Architecture </a><a href="/tags/Git" class="mr-2 inline-block rounded-lg bg-darkBlue px-3 py-2 text-sm text-white no-underline hover:bg-blueGreyed dark:bg-blueGreyed dark:hover:bg-darkBlue"> Git </a> <div class="text-md rounded-lg border border-darkBlue bg-lightYellow p-3 text-left mt-5 dark:text-gray-600 m-auto w-[720px] max-w-full">
This article also exists in:   <a href="../monorepo-pros-and-cons" class="underline"> English </a>  </div> </div> </div> <div class="m-auto w-[720px] max-w-full">  <div class="prose
  max-w-none
  dark:prose-invert
  prose-headings:underline
  prose-h2:text-2xl prose-h2:font-bold prose-h2:dark:text-mainYellow
  prose-h3:text-xl prose-h3:font-bold
  prose-p:mb-0
  prose-p:mt-4
  prose-a:underline-offset-4
  prose-a:decoration-2
  prose-a:text-gray-700 dark:prose-a:text-slate-100 hover:prose-a:text-slate-900
  prose-a:decoration-gray-300
  hover:prose-a:decoration-blue-700 dark:hover:prose-a:decoration-mainYellow
  prose-img:rounded-xl">  <p>La tendance actuelle est de diviser nos codebases. Ces dernières années, on a vu apparaître des
concepts comme les microservices, les micro-frontends…</p>
<p>Et puis à contre-courant, on voit aussi des projets se rassembler sous un seul et unique repository
git. On appelle cela des monorepos (ou monorepository).</p>
<p><img  src="/_astro/mono-vs-multi.0jECb59Z_1Xv5qY.webp" alt="mono vs. mulAstucele repository" width="1906" height="948" loading="lazy" decoding="async"></p>
<p>Ça va faire pas loin de 2 ans maintenant que j’en utilise et maintient un. Cet article est un
condensé de ce que j’aime et n’aime pas avec les monorepos.</p>
<p><em>Contexte: le monorepo sur lequel je travaille contient ~ 40 packages (npm), principalement des
applications vue.js. Toutes ces petites applications font partie d’une plus grande application. Nous
avons décidé de diviser une énorme application en plus petites, car la maintenance était devenue
ingérable. On est à peu près 15 à travailler sur ce monorepo (pas à plein temps).</em></p>
<h2 id="avantages">Avantages</h2>
<h3 id="-teamwork">🤝 Teamwork</h3>
<p><strong>Favorise les contributions</strong>:<br>
Lorsque vous avez déjà le code, c’est plus facile de contribuer. Vous avez déjà tout sous la main.
Plus besoin de rechercher le repo, de le cloner et d’installer les dépendances.</p>
<p><strong>Meilleure vue d’ensemble de l’ensemble du système</strong>:<br>
Quand on a tout le code au même endroit, les informations comme <em>“combien de fois est utilisé tel ou
tel composant?”</em> ou bien <em>“ou est utilisé cet endpoint”</em> se trouvent en un clin d’oeil (avec bon
vieux <code>ctrl + F</code>).</p>
<p><strong>Privilégie les grands refactoring</strong>:<br>
Par la, j’entends que vous pouvez changer un composant présent dans plusieurs packages en un seul
commit. Pareil si vous voulez changer la version d’une librairie…</p>
<p><strong>Supprimez du code mort en toute confiance</strong>:<br>
Combien de fois avez-vous voulu supprimer du code, mais vous ne l’avez pas fait parce que vous ne
saviez pas si le code était utilisé ailleurs? Encore un avantage d’avoir tout le code sous la main.</p>
<p><strong>Source unique de vérité</strong>:<br>
Le projet sur lequel je travaille avait un nom très étrange pour la branche principale. Et puis un
jour on a décidé d’utiliser un autre nom tout aussi étrange pour le remplacer. Certains repos
étaient mis à jour et d’autres non. A chaque fois que quelqu’un clonait le repo, un bourde n’était
jamais bien loin.</p>
<h3 id="-dependencies">👨‍👩‍👧 Dependencies</h3>
<p><strong>Plus de place sur le disque dur</strong>:<br>
Si vous êtes familiers avec l’écosystème JavaScript, vous savez probablement que le dossier
node*module peut être
<a href="https://www.reddit.com/r/ProgrammerHumor/comments/6s0wov/heaviest_objects_in_the_universe/">extrêmement lourd</a>.
Lorsque nous avions environ 30 applications / packages, cela prenait 12 Go sur le disque dur. Oui,
12 Go! Nous avions des dépendances comme Vue.js installées 30 fois. Heureusement, certains outils
(comme yarn) créent un lien symbolique *(symlinks)_ entre les dépendances redondantes lorsque les
workspaces sont activés. Grâce à cette fonctionnalité,
<a href="https://twitter.com/_maxpou/status/1263426573379739651">nous sommes passés de 12 Go à 1.7 Go</a>.</p>
<p><img  src="/_astro/dependency-management.2lLJmuN__ZRSf1X.webp" alt="dependency-management" width="2096" height="1354" loading="lazy" decoding="async"> <em>Note: Je sais que npm 7.0 supporte maintenant
les workspaces. Cependant, c’est encore un petit peu tôt et
<a href="https://github.com/npm/rfcs/pull/117/files">certaines commandes ne sont pas encore supportées</a>.</em></p>
<p><strong>hot-reload entre les packages</strong>:<br>
Certains outils lient automatiquement les dépendances locales entre elles. Ce qui signifie que si
package-a est utilisé dans package-b, vous pouvez travailler sur package-a et voir le résultat en
direct dans package-b.</p>
<p><strong>Ajouter un package est plus simple</strong>:<br>
Pour nous, tous nos packages sont dans un dossier <code>packages</code>. L’ajout d’un nouveau package est très
simple. Pas besoin de paramétrer l’intégration continue (CI), le registre npm, ni de redéfinir les
permissions du GitLab… tout a déjà été fait!</p>
<h2 id="inconvénients">Inconvénients</h2>
<h3 id="-git--code-hosting-platforms-gitlabgithub">🛠 Git &#x26; code hosting platforms (GitLab/GitHub…)</h3>
<p><strong>Autorisation</strong>:<br>
Quand on met des permissions de lecture/ecriture sur GitLab/GitHub/etc., c’est pour le repo tout
entier.</p>
<p><strong>💡 Astuce:</strong> Vous pouvez créer un fichier CODEOWNERS
(<a href="https://docs.gitlab.com/ee/user/project/code_owners.html">doc GitLab</a>,
<a href="https://docs.github.com/en/github/creating-cloning-and-archiving-repositories/about-code-owners">doc GitHub</a>)
pour définir des règles d’autorisation.</p>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.aqfpi.css"><script type="module" src="/_astro/ec.sgewm.js"></script><figure class="frame has-title"><figcaption class="header"><span class="title">.gitlab/CODEOWNERS</span></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#BABED8">packages/app-1 @user1 packages/app-2 @user2</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="packages/app-1 @user1 packages/app-2 @user2"><div></div></button></div></figure></div>
<p><em>Avec l’exemple du dessus, user2 devra avoir l’approbation de user1 pour modifier app-1.</em></p>
<p><strong>Un Git log peu lisible</strong>:<br>
Si les merge requests sont mergées dans l’état avec 10-15 commits, vous allez peut-être avoir
quelques soucis le jour où vous aurez besoin d’utiliser git log.</p>
<p><strong>💡 Astuce:</strong> Si vous pouvez utiliser la méthode du
<a href="git-conventional-commits">“conventional commit”</a> vous pouvez mettre entre parenthèse le nom du
package. Comme ça, ce sera plus facile pour voir l’historique d’un paquet spécifique.</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#9FA4BC;--0fs:italic"># Lister toutes les features du package-B</span></div><div class="ec-line"><span style="--0:#FFCB6B">git</span><span style="--0:#BABED8"> </span><span style="--0:#C3E88D">log</span><span style="--0:#BABED8"> </span><span style="--0:#C3E88D">--all</span><span style="--0:#BABED8"> </span><span style="--0:#C3E88D">--grep=</span><span style="--0:#89DDFF">"</span><span style="--0:#C3E88D">feat(package-B):</span><span style="--0:#89DDFF">"</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#9FA4BC;--0fs:italic"># ou bien:</span></div><div class="ec-line"><span style="--0:#FFCB6B">git</span><span style="--0:#BABED8"> </span><span style="--0:#C3E88D">log</span><span style="--0:#BABED8"> </span><span style="--0:#C3E88D">--all</span><span style="--0:#BABED8"> </span><span style="--0:#C3E88D">path/to/package-b</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="git log --all --grep=&#x22;feat(package-B):&#x22;git log --all path/to/package-b"><div></div></button></div></figure></div>
<p><strong>Git log peut devenir inutilisable</strong>:<br>
Si vous avez beaucoup de commits / branches / tags, cela signifie que vous aurez beaucoup d’objets
git stockés. git peinera peut-être lorsque vous souhaitez obtenir l’historique (git log/git blame).</p>
<p><strong>💡 Astuce:</strong> faites un petit flush du garbage collector de temps à autres (<code>git gc</code>). N’oubliez
pas non plus de supprimer vos vieilles branches (<code>git fetch --all --prune</code> marche bien).</p>
<p><strong>Oubliez les branches de type “next”</strong>:<br>
Votre branche <code>main</code> / <code>master</code> doit être seule source de vérité. Vous ne pouvez pas avoir de
branche <code>next</code>. Ça va être un enfer à maintenir… Si vous souhaitez que certaines fonctionnalités
ne soient disponibles que pour un environnement spécifique, je vous recommande chaudement d’utiliser
des <em>“feature flags”</em>.</p>
<p><strong>Le repo peut devenir très lourd</strong>:<br>
A un moment, le répertoire <code>.git</code> a la racine du monorepo va peut-être atteindre quelques Gb.</p>
<p><strong>💡 Astuce:</strong> Voici 2 options si vous souhaitez économiser de l’espace disque.</p>
<div class="expressive-code"><figure class="frame is-terminal"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#9FA4BC;--0fs:italic"># Clone le repo mais sans historique</span></div><div class="ec-line"><span style="--0:#FFCB6B">git</span><span style="--0:#BABED8"> </span><span style="--0:#C3E88D">clone</span><span style="--0:#BABED8"> </span><span style="--0:#C3E88D">--depth</span><span style="--0:#BABED8"> </span><span style="--0:#F78C6C">1</span><span style="--0:#BABED8"> </span><span style="--0:#C3E88D">&#x3C;repo-url></span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#9FA4BC;--0fs:italic"># 1. clone un repo vide et sans historique</span></div><div class="ec-line"><span style="--0:#9FA4BC;--0fs:italic"># 2. pull uniquement le package-a de la branche main</span></div><div class="ec-line"><span style="--0:#FFCB6B">git</span><span style="--0:#BABED8"> </span><span style="--0:#C3E88D">clone</span><span style="--0:#BABED8"> \</span></div><div class="ec-line"><span style="--0:#BABED8">  </span><span style="--0:#C3E88D">--depth</span><span style="--0:#BABED8"> </span><span style="--0:#F78C6C">1</span><span style="--0:#BABED8"> \</span></div><div class="ec-line"><span style="--0:#BABED8">  </span><span style="--0:#C3E88D">--no-checkout</span><span style="--0:#BABED8"> \</span></div><div class="ec-line"><span style="--0:#BABED8">  </span><span style="--0:#C3E88D">--filter=blob:none</span><span style="--0:#BABED8"> \</span></div><div class="ec-line"><span style="--0:#BABED8">  </span><span style="--0:#C3E88D">&#x3C;repo-url></span></div><div class="ec-line"><span style="--0:#FFCB6B">git</span><span style="--0:#BABED8"> </span><span style="--0:#C3E88D">checkout</span><span style="--0:#BABED8"> </span><span style="--0:#C3E88D">main</span><span style="--0:#BABED8"> </span><span style="--0:#C3E88D">--</span><span style="--0:#BABED8"> </span><span style="--0:#C3E88D">packages/package-a</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="git clone --depth 1 <repo-url>git clone \  --depth 1 \  --no-checkout \  --filter=blob:none \  <repo-url>git checkout main -- packages/package-a"><div></div></button></div></figure></div>
<p><em>Note: Voici un peu de lecture si vous souhaitez en apprendre plus sur le
<a href="https://docs.gitlab.com/ee/topics/git/partial_clone.html">“partial cloning”</a> (en anglais).</em></p>
<h3 id="-continuous-integration-ci">🤖 Continuous Integration (CI)</h3>
<p><strong>Quand c’est cassé, tout le monde est bloqué!</strong><br>
Si la branche <code>main</code> est marquée en rouge par votre intégration continue, tout le monde est impacté.
Vous ne pouvez pas mettre ce problème sous le tapis. Ça doit être traité immédiatement.</p>
<p><strong>Le dilemme de l’intégration continue</strong>:<br>
Si les bases de code sont mutualisées, vous avez plus de code. Qui dit plus de code, dit plus de
travail pour l’intégration continue (CI). Donc plus de tests, de lint, de build…</p>
<p>Lorsqu’il s’agit de CI, le temps est le nerf de la guerre. D’une part, on veut que ce soit le plus
rapide possible et d’autre part on recherche aussi de la fiabilité. Je veux dire, quand mon CI me
donne le feu vert, je suis plus confiant pour fusionner mon travail.</p>
<p>Il peut être tentant de réduire le nombre de packages analysés pour gagner du temps. Mais
l’intégration continue perdra son intérêt car elle ne pourra pas repérer une régression
“cross-repo”.</p>





























<table><thead><tr><th></th><th>Toute la codebase</th><th>Package sélectionné</th><th>Packages affecté</th></tr></thead><tbody><tr><td>Vitesse de Build/lint/test</td><td>🐌 Lent</td><td>🚀 Rapide</td><td>🚗 Normal</td></tr><tr><td>Détecte les cross-packages<br>régression?</td><td>✅ Oui</td><td>❌ Non</td><td>✅ Oui</td></tr><tr><td>Facile à mettre en place?</td><td>😀 Oui</td><td>😀 Oui</td><td>😟 Non</td></tr></tbody></table>
<p>La 3e option est, à mon avis, la plus viable. Mais vous devrez tout faire manuellement. Une 4e
option pourrait utiliser des filtres. Les packages étiquetés “importants” utilisent la 1ère
stratégie et les autres utilisent la 2ème stratégie.</p>
<p><strong>💡 Astuces:</strong></p>
<ul>
<li>Je vous recommande d’ajouter un label spécifique pour shunter la CI (ex <code>NO_CI</code>). Si vous modifiez
une typo dans le README, vous n’avez pas besoin d’exécuter toute une batterie de tests.</li>
<li>Si votre pipeline (CI) comporte des tâches parallèles, n’oubliez pas d’activer l’option
“fail-fast”.</li>
</ul>
<h3 id="-teamwork-1">🤝 Teamwork</h3>
<p><strong>Changements cachés</strong>:<br>
Certains repos sont parfois plus “sensibles” que d’autres. Une erreur d’inattention lors d’une revue
de code et vous vous retrouvez vite avec quelque chose de non désiré.</p>
<p><strong>La quantité de code peut être intimidante</strong>:<br>
La première fois que j’ai “git pull” le code source de Gatsby.js, j’ai extrait l’historique complet
d’environ 90 paquets. Le projet avait ~5 ans et 3000 contributeurs. Je vous laisse imaginer ma tête
quand j’ai ouvert tout ça dans mon IDE. J’étais complètement dépassé. La quantité de code était
juste énorme!</p>
<p>Si vous travaillez avec 10% d’une base de code, vous ne vous souciez probablement pas des 90%
restants.</p>
<h2 id="conclusion">Conclusion</h2>
<p><img  src="/_astro/relevant-monorepo.2Bt4wLlu_12R77n.webp" alt="un monorepo devient pertinent lorsque les packages sont connectés et écrits dans le même langage" width="1930" height="1028" loading="lazy" decoding="async"></p>
<p>Dans l’ensemble, je pense qu’utiliser un monorepo peut être une bonne chose.</p>
<p>Dans notre cas, cela nous facilite grandement la vie. Sur nos 40 packages, 35 sont des applications
vue.js avec une structure et des dépendances très similaires. Et chaque application est une petite
partie d’une grande application. On a pas mis dans le même repo des apps qui n’ont rien à voir entre
elles.</p>
<p>De plus, on reste une équipe à taille humaine. Donc les problèmes énoncés plus hauts se fixent
plutôt rapidement.</p> <div> <hr> <h2 class="dark:text-gray-100">About the author</h2> <div class="flex flex-col md:flex-row items-center gap-5 md:gap-8 mt-5"> <div class="relative flex-shrink-0 h-32 w-32"> <img src="/_astro/profile-picture.gF0h5NUU_Zw8iDo.webp" class="not-prose h-32 w-32 object-cover rounded-full" alt="Maxence Poutord Profile picture" width="128" height="128" loading="lazy" decoding="async"> </div> <div> <p class="!mt-0 pb-2">
Hey, I'm Maxence Poutord, a passionate software engineer. In my
        day-to-day job, I'm working as a senior front-end engineer at Orderfox.
        When I'm not working, you can find me travelling the world or cooking.
</p> <a class="not-prose inline-flex rounded border
    font-semibold no-underline
    transition-colors duration-200 ease-in-out px-3 py-2
    border-[#1da1f2] bg-[#1da1f2] text-white
    hover:border-[#1da1f2] hover:bg-white hover:text-[#1da1f2]" rel="noopener" target="_blank" href="https://twitter.com/intent/follow?screen_name=_maxpou"> <svg aria-label="Twitter" viewBox="0 0 24 24" width="1em" height="1em" class="h-6 w-6 pr-2"><path fill="currentColor" d="M23.954 4.569a10 10 0 0 1-2.825.775 4.958 4.958 0 0 0 2.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 0 0-8.384 4.482C7.691 8.094 4.066 6.13 1.64 3.161a4.822 4.822 0 0 0-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 0 1-2.228-.616v.061a4.923 4.923 0 0 0 3.946 4.827 4.996 4.996 0 0 1-2.212.085 4.937 4.937 0 0 0 4.604 3.417 9.868 9.868 0 0 1-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 0 0 7.557 2.209c9.054 0 13.999-7.496 13.999-13.986 0-.209 0-.42-.015-.63a9.936 9.936 0 0 0 2.46-2.548l-.047-.02z"></path></svg>
Follow @_maxpou
 </a> </div> </div> </div>  </div>  <div> <h2 class="text-2xl underline mt-12 font-bold dark:text-mainYellow">
Recommended posts
</h2> <div class="grid grid-cols-1 gap-4 md:grid-cols-2 mt-6"> <a title="What's happens when you `git commit`" href="/blog/git-under-the-hood/" class="ease flex flex-col rounded-lg bg-white transition duration-300 dark:bg-gray-500 hover:translate-y-0.5 shadow-md  hover:shadow-xl group"> <img src="/_astro/cover.dtWL2vrQ_ZQ0SBb.webp" alt="Cover picture for What's happens when you `git commit`" class="h-56 w-full rounded-b-none rounded-t-lg object-cover transition" width="420" height="224" loading="lazy" decoding="async"> <div class="p-4"> <header class="text-xl font-semibold text-gray-700 dark:text-gray-100"> <span class="inline">  <!-- {post.data.title} --> <span class="from-blue-100 to-blue-100 text-dark dark:bg-none
           bg-gradient-to-r bg-[length:0px_10px] bg-left-bottom bg-no-repeat transition-[background-size] duration-500 hover:bg-[length:100%_3px] group-hover:bg-[length:100%_10px]"> What&#39;s happens when you `git commit` </span> </span> </header> <p class="date text-gray-400 dark:text-gray-100"> <time datetime="2019-10-14T00:00:00.000Z"> 14 October 2019 </time> </p> </div> </a><a title="3 Tips for Scaling Large Vue.js Application" href="/blog/3-tips-scaling-vue-application/" class="ease flex flex-col rounded-lg bg-white transition duration-300 dark:bg-gray-500 hover:translate-y-0.5 shadow-md  hover:shadow-xl group"> <img src="/_astro/cover.ex1KwcGk_Z1CSi66.webp" alt="Cover picture for 3 Tips for Scaling Large Vue.js Application" class="h-56 w-full rounded-b-none rounded-t-lg object-cover transition" width="420" height="224" loading="lazy" decoding="async"> <div class="p-4"> <header class="text-xl font-semibold text-gray-700 dark:text-gray-100"> <span class="inline">  <!-- {post.data.title} --> <span class="from-blue-100 to-blue-100 text-dark dark:bg-none
           bg-gradient-to-r bg-[length:0px_10px] bg-left-bottom bg-no-repeat transition-[background-size] duration-500 hover:bg-[length:100%_3px] group-hover:bg-[length:100%_10px]"> 3 Tips for Scaling Large Vue.js Application </span> </span> </header> <p class="date text-gray-400 dark:text-gray-100"> <time datetime="2018-12-13T00:00:00.000Z"> 13 December 2018 </time> </p> </div> </a> </div> </div>  </div> </article>  </main> <footer class="bg-blue-50 dark:bg-gray-600 dark:text-white w-full mx-auto pb-0" data-astro-cid-sz7xmlte> <div class="m-auto flex w-[1024px] max-w-full flex-wrap justify-between" data-astro-cid-sz7xmlte> <div class="w-full pb-4 md:w-auto flex-auto" data-astro-cid-sz7xmlte> <p class="pb-1 font-bold" data-astro-cid-sz7xmlte>
&copy; 2014 - 2024 - Maxence Poutord </p> <p data-astro-cid-sz7xmlte>Built with Astro, Tailwind and some ☕️</p> <p data-astro-cid-sz7xmlte>
Hosted with <span class="text-red-500" data-astro-cid-sz7xmlte>❤</span> by <a class="hover:text-gray-700 hover:underline dark:hover:text-mainYellow" href="https://github.com/maxpou/maxpou.fr" data-astro-cid-sz7xmlte>GitHub</a>.
</p> </div> <div class="flex-auto" data-astro-cid-sz7xmlte> <h3 class="pb-1 font-bold" data-astro-cid-sz7xmlte>Explore</h3> <ul data-astro-cid-sz7xmlte> <li data-astro-cid-sz7xmlte> <a href="/uses" target="_self" class="hover:text-gray-700 hover:underline dark:hover:text-mainYellow" data-astro-cid-sz7xmlte> Uses </a> </li><li data-astro-cid-sz7xmlte> <a href="/recipes" target="_self" class="hover:text-gray-700 hover:underline dark:hover:text-mainYellow" data-astro-cid-sz7xmlte> Recipes (kitchen) </a> </li><li data-astro-cid-sz7xmlte> <a href="/about" target="_self" class="hover:text-gray-700 hover:underline dark:hover:text-mainYellow" data-astro-cid-sz7xmlte> About </a> </li><li data-astro-cid-sz7xmlte> <a href="/cv" target="_blank" class="hover:text-gray-700 hover:underline dark:hover:text-mainYellow" data-astro-cid-sz7xmlte> Resume (cv) </a> </li><li data-astro-cid-sz7xmlte> <a href="/readme" target="_self" class="hover:text-gray-700 hover:underline dark:hover:text-mainYellow" data-astro-cid-sz7xmlte> Readme </a> </li> </ul> </div> <div class="flex-auto" data-astro-cid-sz7xmlte> <h3 class="pb-1 font-bold flex-auto" data-astro-cid-sz7xmlte>Let's connect</h3> <ul data-astro-cid-sz7xmlte> <li data-astro-cid-sz7xmlte> <a href="https://github.com/maxpou" rel="noopener noreferrer" class="hover:text-gray-700 hover:underline dark:hover:text-mainYellow" data-astro-cid-sz7xmlte> GitHub </a> </li><li data-astro-cid-sz7xmlte> <a href="https://twitter.com/_maxpou" rel="noopener noreferrer" class="hover:text-gray-700 hover:underline dark:hover:text-mainYellow" data-astro-cid-sz7xmlte> Twitter </a> </li><li data-astro-cid-sz7xmlte> <a href="https://www.linkedin.com/in/maxpou/" rel="noopener noreferrer" class="hover:text-gray-700 hover:underline dark:hover:text-mainYellow" data-astro-cid-sz7xmlte> LinkedIn </a> </li><li data-astro-cid-sz7xmlte> <a href="/rss.xml" class="hover:text-gray-700 hover:underline dark:hover:text-mainYellow" data-astro-cid-sz7xmlte> RSS feed </a> </li> </ul> </div> </div>  </footer>  </body> </html>