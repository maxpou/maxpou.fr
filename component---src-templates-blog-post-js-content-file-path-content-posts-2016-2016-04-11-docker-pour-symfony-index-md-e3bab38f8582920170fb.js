"use strict";(self.webpackChunkmaxpou_fr=self.webpackChunkmaxpou_fr||[]).push([[4e3],{7153:function(n,e,a){a.r(e),a.d(e,{default:function(){return h}});var s=a(1151),t=a(7294);function p(n){const e=Object.assign({blockquote:"blockquote",p:"p",br:"br",a:"a",h1:"h1",span:"span",em:"em",h2:"h2",img:"img",ul:"ul",li:"li",strong:"strong"},(0,s.ah)(),n.components);return t.createElement(t.Fragment,null,t.createElement(e.blockquote,null,"\n",t.createElement(e.p,null,"[05/07/2016] : màj du docker-compose (suppression conteneur code+alias) + màj schéma + ajout\nPHPMyAdmin + simplification toolbox.",t.createElement(e.br),"\n","Un grand merci à tous ceux qui m’ont fait des retours ♥"),"\n"),"\n",t.createElement(e.p,null,"TL;DR : ",t.createElement(e.a,{href:"https://github.com/maxpou/docker-symfony"},"Répo Github du projet")),"\n",t.createElement(e.h1,{id:"une-stack-docker-pour-votre-application-symfony",style:{position:"relative"}},t.createElement(e.a,{href:"#une-stack-docker-pour-votre-application-symfony","aria-label":"une stack docker pour votre application symfony permalink",className:"anchor before"},t.createElement(e.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Une stack Docker pour votre application Symfony"),"\n",t.createElement(e.p,null,"Je développe des applications web depuis quelques temps sur une stack\n",t.createElement(e.a,{href:"https://github.com/maxpou/scotch-box"},"Vagrant que j’ai un peu pimpé"),". Bosser sur une VM est\nvraiment plus agréable/malléable qu’un WAMP. Cependant, cette solution si miraculeuse soit-elle a\naussi ses inconvénients."),"\n",t.createElement(e.p,null,"Tout d’abord, le temps d’initialisation de la box est particulièrement long. Deuxième argument, si\non se plante on est obligé de tout réinstaller (",t.createElement(e.em,null,"ex:")," récemment j’ai oublié de mettre un point avant\nle slash de cette commande… ",t.createElement(e.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">sudo rm -rf /</code>'}}),"). Et enfin, si on souhaite instancier plusieurs\nmachines sur une seule, le PC hôte se retrouve rapidement sur les rotules."),"\n",t.createElement(e.span,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 580px; "\n    >\n      <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 66.21621621621621%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAADJElEQVR42gEZA+b8AMbb9MTa8sTb9MTb+MLa9sXf+9Ln/Nrl8dDe7p+31bPN68La98zj/sji/r/a+7/a+sHc+8jg/sTc+MHY9ADJ3fTW6f7a6Pnq7vL09vjl5umknKhgVHRZXoGWoLNxgZ+cqb+Xqb+wu87r9v/q8/vZ5vOqw9y5z+rD2PUAw9DikJ+xY3iZX3OScoOfd32Ph36MmoeWeH2WWHGQQl2DMU13HEBxTF2Cg5ColJ2weoihMlaDaIeswdbzAL7O43tygzAzWw4hUxIjVBwrWStDbTxTezhMdmBfej5CZwwjVRQtXyQ7byA8cR47ciNBeCRCeSRDeYqkxwDCzd66rrZ1cos/TXI8RmshMFsZMl4vQWdVYX+lnql+fZM7T3UzTHYrQnEoPnArQHAwQnQxQnRDVIWtwuEAfJW1VFt2GStXCiJRDCNSDiZUEy9bJD1mL0VtS1BxJzZfBiFTCyVXGzdqIT5xJEFzJ0R1JEF1Kkd7la3NAIafvrykrnBpgTdEaDE7YhsrVhUvWiY8YjlLbqeMmn91ijJEbC0/aSk8aSY6aSk8aiw+bik7bT1Qfqu+2gCos8BUZXwcNV4RK1YVLVcDIE8WMFlAS2YzSm9UZH4hO2UkOlkuRGIYOGsmQ3MvTXotTHkoRHMnQ3aNosEA5t7dt56jT0NcMTFRLjFSLztfM0ZpWWB0LT9jeV1wWUpjRkJOTEtaLz5oLz9rKj1rKjtpJTdmR1WBoq/MAJ6bs3+HnTJBYBYsVQomURMuWUtceHmDjyI4Xg0oU1deanp2XkVIRi9Kah87bTlUfq65yTdQe1VxmXubvwBuiK5ZeZ5rdItAQmEZKVETLFRBZHp1iptWa4YLIEyNe265sHZ5d1xIS1BVYoJ3gZh+kaFIdJtmhqilwNMAYoCbSHyZVoCacXN7aWZwTFtuRWZ9SFl2OlR3V152q5NhxLN1iYODX2Fya3yaWml+SVZdO3CRWpK8pbvNADdSdChMaS9WeDdKXWN5i0xkf0dphkZjgkNhf1dmfTdIYj49QmhlRWNmOFpaUGBmcW6ElXKPo0pRWFZgarmfXvLrWlRnAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n  ></span>\n  <picture>\n          <source\n              srcset="/static/6f7ef7e1ab699b484ec3208a3b15c208/cbe2e/multishipsonship.webp 148w,\n/static/6f7ef7e1ab699b484ec3208a3b15c208/3084c/multishipsonship.webp 295w,\n/static/6f7ef7e1ab699b484ec3208a3b15c208/4fac6/multishipsonship.webp 580w"\n              sizes="(max-width: 580px) 100vw, 580px"\n              type="image/webp"\n            />\n          <source\n            srcset="/static/6f7ef7e1ab699b484ec3208a3b15c208/12f09/multishipsonship.png 148w,\n/static/6f7ef7e1ab699b484ec3208a3b15c208/e4a3f/multishipsonship.png 295w,\n/static/6f7ef7e1ab699b484ec3208a3b15c208/b6272/multishipsonship.png 580w"\n            sizes="(max-width: 580px) 100vw, 580px"\n            type="image/png"\n          />\n          <img\n            class="gatsby-resp-image-image"\n            src="/static/6f7ef7e1ab699b484ec3208a3b15c208/b6272/multishipsonship.png"\n            alt="one ship with carrying multiples ships"\n            title=""\n            loading="lazy"\n            decoding="async"\n            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n          />\n        </picture>\n    </span>'}}),"\n",t.createElement(e.p,null,"Ce sont donc ces trois points qui m’ont motivé à migrer mon poste de dev sur Docker (et puis si\nautant de monde en parle, c’est sans doutes que ça vaut le détour !)."),"\n",t.createElement(e.p,null,"Je vais volontairement passer sous silence l’étape de présentation de Docker. Il y a plein\nd’articles/conférences à ce sujet sur la toile. Voici une conférence que j’ai bien aimé à ce sujet :\n",t.createElement(e.a,{href:"https://www.youtube.com/watch?v=CUVBNrqFRHk"},"Docker de “Zéro” à “Héros”")," par l’excellent Nicolas DE\nLOOF (qui anime aussi la web série\n",t.createElement(e.a,{href:"https://www.youtube.com/channel/UCOAhkxpryr_BKybt9wIw-NQ"},"Quoi d’neuf Docker ?"),")."),"\n",t.createElement(e.h2,{id:"un-conteneur-pour-les-gouverner-tous-",style:{position:"relative"}},t.createElement(e.a,{href:"#un-conteneur-pour-les-gouverner-tous-","aria-label":"un conteneur pour les gouverner tous  permalink",className:"anchor before"},t.createElement(e.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Un conteneur pour les gouverner tous ?"),"\n",t.createElement(e.p,null,"Lors de mes premières expériences avec Docker, j’étais parti sur un méga-conteneur qui portait PHP,\nApache, MySQL… tout ce qui est nécessaire pour faire tourner une application web. Et puis j’ai\nvite lâché l’affaire car je ne voyais pas la plus-value de cet outil comparé à ma vagrant.\n",t.createElement(e.img,{src:"/0eda0e59c7226cbc03da2e5146e96f07/shiponship.gif",alt:"one ship with carrying one ship"})," ",t.createElement(e.em,null,"(ma première expérience avec Docker)")),"\n",t.createElement(e.h2,{id:"1-application-process--1-conteneur",style:{position:"relative"}},t.createElement(e.a,{href:"#1-application-process--1-conteneur","aria-label":"1 application process  1 conteneur permalink",className:"anchor before"},t.createElement(e.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"1 application (process) = 1 conteneur"),"\n",t.createElement(e.p,null,"A l’occasion du ",t.createElement(e.a,{href:"https://github.com/docker/docker-birthday-3"},"3e anniversaire de Docker"),", j’ai\nvraiment vu l’intérêt de cet outil. Sans doutes, parce que le TP était plus pertinent que bon nombre\nd’articles sur la toile. Il faut donc lancer un process par conteneur. Le tout se fera avec\ndocker-compose, qui jouera le rôle de chef d’orchestre de tous mes conteneurs."),"\n",t.createElement(e.p,null,"Voici l’objectif vers lequel je souhaite tendre :"),"\n",t.createElement(e.span,{dangerouslySetInnerHTML:{__html:'<span\n      class="gatsby-resp-image-wrapper"\n      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; "\n    >\n      <span\n    class="gatsby-resp-image-background-image"\n    style="padding-bottom: 64.1891891891892%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABcRAAAXEQHKJvM/AAADS0lEQVR42o1SS2gbVxS9qdNxG6v0k5CG0qYbU6hLySIloYVuvTDdZCEMwZgW0WIv7UJtyEKb9GODCwaTVKFCxbYiV46lWpE/ctyqbrGjNo4SWSNZtqSRMqPPjDQjjRSNNBqNdcvI9aIhkF5478C99533zj0PvCRZCTG7lbltZylfzCFF768DANjuLL2z8sAvZrmUlGFTYoZNYSwZWdVqiNim4VIwECjms5i0/qiKDIUZIctDWZLwARvG77fMBw1sYi6f+QsAnndvzn9ERsLqzMws/nD9urrx+wYymYRW6xgwXjoNACd5pRaUYzFc//iCIgaDWMeDHIiSiPvlR3gvvaOKKCFfzG1qt2/vbr3/iE40KIrCUCiksiyHcTp6DwBeI0mSAIC2slTaqdcbuH3fr7JcDquyxAOdiS8maOr26tqSSyjmPeH4zrhG6At434xEQw46nXRRTNyxGyXvkPsPrwJA+6WBD7UXAp3a+y6ajCzYHDdnA+T2XIyOmLQ8GI3G4xaL5QV4dhzTtk++OH8K3oZXbm75LFwh97dUr3pjOX4zkU4strrsdntLQqVSOTM0NDQ/Pj7+zbNI4TS8nsyz+xIiNhpFtSGzyJcKXKum1+uJ6enpjsHBwfO9vb3Y3d0depIFEY+RiESz2WxHRKKrCwiuWAgzVcR4fEfFWhLLUvGQcGJi4sW+vr4ORDw5OjpqHh4evvI/5EOMJmdYLnHf7XH/4Q8HffFU1H0kuU2v1+sA4CxBEF06ne5dAHjj3/k+p6HJ5Tq7Ggg4BIG+zRe5xWq17hJEYUEoCLcUVOaVA8WZTMfMLcK1tbUPrFbrsMlkOnU0gs7OznaNzOv1HtdyfmrvHMPRitcxhrWy2Nx7fBc99DXUIvJwq+nz2LBSLR9KtlgsX01OTqLZbD6nmTM1NaUzGo0ntDU2NvaS1hOiQhcTiUjly08v1PksXdst+OSf/FdkXsnKd1d+rt34ekAVSwLTIuzp6bnY39/fPzIy8vJ/nDw0oyX51z9X3ktnU3WWJrEkCk1ZriMrMChJFRTFUrMmK5jKMNzROe2jvgUAxNPc1fCa9dtX5xamP1ve+M3g9iwaltedBpt91rC+sWxwum2G+V9mP3eu2i//A+RfGLzZFlitAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n  ></span>\n  <picture>\n          <source\n              srcset="/static/81662f9887250d03f477171365181b82/cbe2e/schema-v2.webp 148w,\n/static/81662f9887250d03f477171365181b82/3084c/schema-v2.webp 295w,\n/static/81662f9887250d03f477171365181b82/5ca24/schema-v2.webp 590w,\n/static/81662f9887250d03f477171365181b82/dad35/schema-v2.webp 885w,\n/static/81662f9887250d03f477171365181b82/2baf0/schema-v2.webp 1180w,\n/static/81662f9887250d03f477171365181b82/e5c51/schema-v2.webp 1350w"\n              sizes="(max-width: 590px) 100vw, 590px"\n              type="image/webp"\n            />\n          <source\n            srcset="/static/81662f9887250d03f477171365181b82/12f09/schema-v2.png 148w,\n/static/81662f9887250d03f477171365181b82/e4a3f/schema-v2.png 295w,\n/static/81662f9887250d03f477171365181b82/fcda8/schema-v2.png 590w,\n/static/81662f9887250d03f477171365181b82/efc66/schema-v2.png 885w,\n/static/81662f9887250d03f477171365181b82/c83ae/schema-v2.png 1180w,\n/static/81662f9887250d03f477171365181b82/21482/schema-v2.png 1350w"\n            sizes="(max-width: 590px) 100vw, 590px"\n            type="image/png"\n          />\n          <img\n            class="gatsby-resp-image-image"\n            src="/static/81662f9887250d03f477171365181b82/fcda8/schema-v2.png"\n            alt="schema"\n            title=""\n            loading="lazy"\n            decoding="async"\n            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"\n          />\n        </picture>\n    </span>'}}),"\n",t.createElement(e.p,null,"Détail des conteneurs :"),"\n",t.createElement(e.ul,null,"\n",t.createElement(e.li,null,"NGINX : le serveur web ;"),"\n",t.createElement(e.li,null,"PHP-FPM : le service qui exécutera le code PHP (PHP7 s’il vous plait !) ;"),"\n",t.createElement(e.li,null,"Application : un conteneur qui portera le code symfony ;"),"\n",t.createElement(e.li,null,"MySQL : Un SGBDR que l’on ne présente plus ;"),"\n",t.createElement(e.li,null,"Redis : Un SGBD clé-valeur avec lequel j’aime bien jouer en ce moment ;"),"\n",t.createElement(e.li,null,"ELK : Le trio de choc : Elasticsearch - Logstash - Kibana… parcequ’il y a mieux que les ",t.createElement(e.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">| tail</code>'}}),"\n/ ",t.createElement(e.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">| grep</code>'}})," pour visualiser ses logs !"),"\n"),"\n",t.createElement(e.p,null,t.createElement(e.em,null,"Nota : Je suis parti du\n",t.createElement(e.a,{href:"https://vincent.composieux.fr/article/faire-tourner-une-application-symfony-avec-docker-et-docker-compose"},"travail de Vincent COMPOSIEUX"),"\nqui est plutôt propre pour ensuite l’adapter à mes besoins.")),"\n",t.createElement(e.h2,{id:"solution",style:{position:"relative"}},t.createElement(e.a,{href:"#solution","aria-label":"solution permalink",className:"anchor before"},t.createElement(e.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Solution"),"\n",t.createElement(e.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment"># docker-compose.yml</span>\n<span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">\'2\'</span>\n\n<span class="token key atrule">services</span><span class="token punctuation">:</span>\n  <span class="token key atrule">db</span><span class="token punctuation">:</span>\n    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql\n    <span class="token key atrule">ports</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> 3306<span class="token punctuation">:</span><span class="token number">3306</span>\n    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token string">\'./.data/db:/var/lib/mysql\'</span>\n    <span class="token key atrule">environment</span><span class="token punctuation">:</span>\n      <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span> root\n  <span class="token key atrule">redis</span><span class="token punctuation">:</span>\n    <span class="token key atrule">image</span><span class="token punctuation">:</span> redis<span class="token punctuation">:</span>alpine\n    <span class="token key atrule">ports</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> 6379<span class="token punctuation">:</span><span class="token number">6379</span>\n  <span class="token key atrule">php</span><span class="token punctuation">:</span>\n    <span class="token key atrule">build</span><span class="token punctuation">:</span> php7<span class="token punctuation">-</span>fpm\n    <span class="token key atrule">ports</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> 9000<span class="token punctuation">:</span><span class="token number">9000</span>\n    <span class="token key atrule">links</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> db<span class="token punctuation">:</span>mysqldb\n      <span class="token punctuation">-</span> redis\n    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> chemin/vers/votre/app/symfony<span class="token punctuation">:</span>/var/www/symfony\n      <span class="token punctuation">-</span> ./logs/symfony<span class="token punctuation">:</span>/var/www/symfony/app/logs\n  <span class="token key atrule">nginx</span><span class="token punctuation">:</span>\n    <span class="token key atrule">build</span><span class="token punctuation">:</span> nginx\n    <span class="token key atrule">ports</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token datetime number">80:80</span>\n    <span class="token key atrule">links</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> php\n    <span class="token key atrule">volumes_from</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> php\n    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> ./logs/nginx/<span class="token punctuation">:</span>/var/log/nginx\n  <span class="token key atrule">elk</span><span class="token punctuation">:</span>\n    <span class="token key atrule">image</span><span class="token punctuation">:</span> willdurand/elk\n    <span class="token key atrule">ports</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> <span class="token datetime number">81:80</span>\n    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> ./elk/logstash<span class="token punctuation">:</span>/etc/logstash\n      <span class="token punctuation">-</span> ./elk/logstash/patterns<span class="token punctuation">:</span>/opt/logstash/patterns\n    <span class="token key atrule">volumes_from</span><span class="token punctuation">:</span>\n      <span class="token punctuation">-</span> php\n      <span class="token punctuation">-</span> nginx</code></pre></div>'}}),"\n",t.createElement(e.p,null,"La 22 et 23e ligne du fichier (",t.createElement(e.em,null,"services.php.volumes"),") indiquent qu’il y a un mapping de volumes. Il\nvous faudra donc indiquer le chemin (absolu ou relatif) vers l’application Symfony. Le répertoire de\nlogs se construiera tout seul comme un grand."),"\n",t.createElement(e.p,null,"2 composantes du docker-compose n’étant pas des images, il faut donc construire les Dockerfiles."),"\n",t.createElement(e.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># nginx/Dockerfile</span>\nFROM debian:jessie\n\nMAINTAINER Maxence POUTORD <span class="token operator">&lt;</span>maxence.poutord@gmail.com<span class="token operator">></span>\n\nRUN <span class="token function">apt-get</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> <span class="token punctuation">\\</span>\n    nginx\n\nADD nginx.conf /etc/nginx/\nADD symfony.conf /etc/nginx/sites-available/\n\nRUN <span class="token function">ln</span> <span class="token parameter variable">-s</span> /etc/nginx/sites-available/symfony.conf /etc/nginx/sites-enabled/symfony\nRUN <span class="token function">rm</span> /etc/nginx/sites-enabled/default\n\nRUN <span class="token builtin class-name">echo</span> <span class="token string">"upstream php-upstream { server php:9000; }"</span> <span class="token operator">></span> /etc/nginx/conf.d/upstream.conf\n\nRUN <span class="token function">usermod</span> <span class="token parameter variable">-u</span> <span class="token number">1000</span> www-data\n\nCMD <span class="token punctuation">[</span><span class="token string">"nginx"</span><span class="token punctuation">]</span>\n\nEXPOSE <span class="token number">80</span>\nEXPOSE <span class="token number">443</span></code></pre></div>'}}),"\n",t.createElement(e.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># php7-fpm/Dockerfile</span>\nFROM php:7.0-fpm\n\nMAINTAINER Maxence POUTORD <span class="token operator">&lt;</span>maxence.poutord@gmail.com<span class="token operator">></span>\n\nRUN <span class="token function">apt-get</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> <span class="token punctuation">\\</span>\n    <span class="token function">git</span> <span class="token punctuation">\\</span>\n    <span class="token function">unzip</span>\n\n<span class="token comment"># Install Composer</span>\nRUN <span class="token function">curl</span> <span class="token parameter variable">-sS</span> https://getcomposer.org/installer <span class="token operator">|</span> php -- --install-dir<span class="token operator">=</span>/usr/local/bin <span class="token parameter variable">--filename</span><span class="token operator">=</span>composer\nRUN <span class="token function">composer</span> <span class="token parameter variable">--version</span>\n\n<span class="token comment"># Set timezone</span>\nRUN <span class="token function">rm</span> /etc/localtime\nRUN <span class="token function">ln</span> <span class="token parameter variable">-s</span> /usr/share/zoneinfo/Europe/Paris /etc/localtime\nRUN <span class="token string">"date"</span>\n\n<span class="token comment"># Type docker-php-ext-install to see available extensions</span>\nRUN docker-php-ext-install pdo pdo_mysql\n\nRUN <span class="token builtin class-name">echo</span> <span class="token string">\'alias sf="php app/console"\'</span> <span class="token operator">>></span> ~/.bashrc\n\nWORKDIR /var/www/symfony</code></pre></div>'}}),"\n",t.createElement(e.p,null,"Il faut garder à l’esprit que les images se doivent d’être les plus petites possibles. Il ne faut\ninstaller que ce qui est nécessaire (le apt-get clean est\n",t.createElement(e.a,{href:"https://github.com/docker/docker/blob/03e2923e42446dbb830c654d0eec323a0b4ef02a/contrib/mkimage/debootstrap#L82-L105"},"implicite sur les debian"),").",t.createElement(e.br),"\n","Une fois que tout est prêt, un petit ",t.createElement(e.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">docker-compose build</code>'}})," permettra de construire les différentes\nimages. Et un ",t.createElement(e.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">docker-compose up</code>'}})," lancera le tout."),"\n",t.createElement(e.p,null,"Vous pouvez vérifier avec la commande docker-compose ps (tout doit-être à Up) :"),"\n",t.createElement(e.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">docker-compose</span> <span class="token function">ps</span>\n           Name                          Command               State              Ports\n--------------------------------------------------------------------------------------------------\ndockersymfony_db_1            /entrypoint.sh mysqld            Up      <span class="token number">0.0</span>.0.0:3306-<span class="token operator">></span><span class="token number">3306</span>/tcp\ndockersymfony_elk_1           /usr/bin/supervisord <span class="token parameter variable">-n</span> <span class="token parameter variable">-c</span> <span class="token punctuation">..</span>.   Up      <span class="token number">0.0</span>.0.0:81-<span class="token operator">></span><span class="token number">80</span>/tcp\ndockersymfony_nginx_1         nginx                            Up      <span class="token number">443</span>/tcp, <span class="token number">0.0</span>.0.0:80-<span class="token operator">></span><span class="token number">80</span>/tcp\ndockersymfony_php_1           php-fpm                          Up      <span class="token number">0.0</span>.0.0:9000-<span class="token operator">></span><span class="token number">9000</span>/tcp\ndockersymfony_redis_1         /entrypoint.sh redis-server      Up      <span class="token number">0.0</span>.0.0:6379-<span class="token operator">></span><span class="token number">6379</span>/tcp</code></pre></div>'}}),"\n",t.createElement(e.p,null,"Maintenant, vous allez devoir retrouver l’IP associée au conteneur NGINX et modifier votre fichier\nhosts :"),"\n",t.createElement(e.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">docker</span> inspect <span class="token parameter variable">--format</span> <span class="token string">\'{{ .NetworkSettings.IPAddress }}\'</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-f</span> <span class="token assign-left variable">name</span><span class="token operator">=</span>nginx <span class="token parameter variable">-q</span><span class="token variable">)</span></span>\n<span class="token comment"># unix seulement (sur Windows, modifier ce fichier C:\\Windows\\System32\\drivers\\etc\\hosts)</span>\n$ <span class="token function">sudo</span> <span class="token builtin class-name">echo</span> <span class="token string">"171.17.0.1 symfony.dev"</span> <span class="token operator">>></span> /etc/hosts</code></pre></div>'}}),"\n",t.createElement(e.p,null,"Vous devrez aussi modifier le fichier parameters.yml de votre application :"),"\n",t.createElement(e.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token comment"># path/to/sfApp/app/config/parameters.yml</span>\n<span class="token key atrule">parameters</span><span class="token punctuation">:</span>\n  <span class="token key atrule">redis_host</span><span class="token punctuation">:</span> redis\n  <span class="token key atrule">database_host</span><span class="token punctuation">:</span> mysqldb</code></pre></div>'}}),"\n",t.createElement(e.p,null,"Et voilà !"),"\n",t.createElement(e.img,{src:"/b533308cb5fe7d617ceeb34fdfb67ecf/etvoila.gif",alt:"et voila gif"}),"\n",t.createElement(e.p,null,"Accédez à votre application sur ",t.createElement(e.a,{href:"http://symfony.dev/"},"symfony.dev")," pour voir votre application et\nsur ",t.createElement(e.a,{href:"http://symfony.dev:81/"},"symfony.dev:81")," pour consulter les logs avec Kibana."),"\n",t.createElement(e.p,null,t.createElement(e.strong,null,"Le code source est sur mon répo GitHub")," : https://github.com/maxpou/docker-symfony"),"\n",t.createElement(e.h2,{id:"et-je-veux-mon-phpmyadmin-moi-",style:{position:"relative"}},t.createElement(e.a,{href:"#et-je-veux-mon-phpmyadmin-moi-","aria-label":"et je veux mon phpmyadmin moi  permalink",className:"anchor before"},t.createElement(e.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Et je veux mon PHPMyAdmin moi !"),"\n",t.createElement(e.p,null,"C’est très simple, il suffit d’ajouter ceci à votre fichier docker-compose :"),"\n",t.createElement(e.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">phpmyadmin</span><span class="token punctuation">:</span>\n  <span class="token key atrule">image</span><span class="token punctuation">:</span> phpmyadmin/phpmyadmin\n  <span class="token key atrule">ports</span><span class="token punctuation">:</span>\n    <span class="token punctuation">-</span> <span class="token string">\'8080:80\'</span>\n  <span class="token key atrule">links</span><span class="token punctuation">:</span>\n    <span class="token punctuation">-</span> db</code></pre></div>'}}),"\n",t.createElement(e.p,null,"Accédez ensuite à l’interface web via : ",t.createElement(e.a,{href:"http://symfony.dev:8080/"},"symfony.dev:8080")),"\n",t.createElement(e.h2,{id:"boîte-à-outils",style:{position:"relative"}},t.createElement(e.a,{href:"#bo%C3%AEte-%C3%A0-outils","aria-label":"boîte à outils permalink",className:"anchor before"},t.createElement(e.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Boîte à outils"),"\n",t.createElement(e.p,null,"Voici quelques commandes qui peuvent-être utiles :"),"\n",t.createElement(e.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># Acceder en bash</span>\n$ <span class="token function">docker-compose</span> <span class="token builtin class-name">exec</span> php <span class="token function">bash</span>\n<span class="token comment"># Composer (ex : composer update)</span>\n$ <span class="token function">docker-compose</span> <span class="token builtin class-name">exec</span> php <span class="token function">composer</span> update\n<span class="token comment"># Commandes Symfony</span>\n$ <span class="token function">docker-compose</span> <span class="token builtin class-name">exec</span> php php /var/www/symfony/app/console cache:clear\n<span class="token comment"># Commandes Symfony bis (avec un alias = plus simple!)</span>\n$ <span class="token function">docker-compose</span> <span class="token builtin class-name">exec</span> php <span class="token function">bash</span>\n$ sf cache:clear\n<span class="token comment"># Commandes MySQL</span>\n$ <span class="token function">docker-compose</span> <span class="token builtin class-name">exec</span> db mysql <span class="token parameter variable">-uroot</span> -p<span class="token string">"root"</span>\n<span class="token comment"># Commandes Redis</span>\n$ <span class="token function">docker-compose</span> <span class="token builtin class-name">exec</span> redis redis-cli\n<span class="token comment"># F***ing cache/logs ;)</span>\n$ <span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token parameter variable">-R</span> <span class="token number">777</span> symfony/app/cache symfony/app/logs\n<span class="token comment"># Vérifier la consommation de CPU</span>\n$ <span class="token function">docker</span> stats <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> inspect <span class="token parameter variable">-f</span> <span class="token string">"{{ .Name }}"</span> <span class="token punctuation">$(</span>docker <span class="token function">ps</span> -q<span class="token punctuation">)</span><span class="token variable">)</span></span>\n<span class="token comment"># Supprimer conteneurs</span>\n$ <span class="token function">docker</span> <span class="token function">rm</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span> <span class="token parameter variable">-q</span><span class="token variable">)</span></span></code></pre></div>'}}))}var o=function(n){void 0===n&&(n={});const{wrapper:e}=Object.assign({},(0,s.ah)(),n.components);return e?t.createElement(e,n,t.createElement(p,n)):p(n)},l=a(4222),c=a(418),r=a(4529),i=a(7953),u=a(4849),m=a(5536),d=a(2404);function k(n){let{data:e,pageContext:a,children:s,location:p}=n;const o=e.post,{previous:k,next:h}=a;return t.createElement(l.Z,{location:p},t.createElement(m.Z,{title:o.frontmatter.title,description:o.frontmatter.description||o.excerpt,cover:o.frontmatter.cover&&o.frontmatter.cover.publicURL,imageShare:o.frontmatter.imageShare&&o.frontmatter.imageShare.publicURL,lang:o.frontmatter.language,translations:o.frontmatter.translations,path:o.frontmatter.slug,isBlogPost:!0}),t.createElement(r.Z,{heroImg:o.frontmatter.cover,title:o.frontmatter.title}),t.createElement(c.Z,null,t.createElement(i.Z,{post:o},s)),t.createElement(c.Z,{as:"aside"},t.createElement(d.Z,{slug:o.frontmatter.slug,title:o.frontmatter.title,redditPostId:o.frontmatter.redditPostId})),t.createElement(u.Z,{previous:k,next:h}))}function h(n){return t.createElement(k,n,t.createElement(o,n))}}}]);
//# sourceMappingURL=component---src-templates-blog-post-js-content-file-path-content-posts-2016-2016-04-11-docker-pour-symfony-index-md-e3bab38f8582920170fb.js.map