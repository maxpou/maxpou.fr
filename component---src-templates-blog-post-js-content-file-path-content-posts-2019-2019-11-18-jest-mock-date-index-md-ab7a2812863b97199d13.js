"use strict";(self.webpackChunkmaxpou_fr=self.webpackChunkmaxpou_fr||[]).push([[4304],{1326:function(n,e,a){a.r(e),a.d(e,{default:function(){return h}});var t=a(1151),s=a(7294);function o(n){const e=Object.assign({p:"p",em:"em",blockquote:"blockquote",h2:"h2",a:"a",span:"span"},(0,t.ah)(),n.components);return s.createElement(s.Fragment,null,s.createElement(e.p,null,s.createElement(e.em,null,"I spent too many hours trying to mock correctly the JavaScript‚Äôs Date object. I tried a few things\nI‚Äôve found on Google‚Ä¶ without success. I finally ended up with a kinda handcrafted solution.")),"\n",s.createElement(e.blockquote,null,"\n",s.createElement(e.p,null,"Every time we mock, we diverge from the real world scenario."),"\n"),"\n",s.createElement(e.p,null,"For this reason, I tend not to mock‚Ä¶ but sometimes, there are not many choices. Fortunately, Date\nis one good exception!"),"\n",s.createElement(e.h2,{id:"everybody-on-the-same-timezone",style:{position:"relative"}},s.createElement(e.a,{href:"#everybody-on-the-same-timezone","aria-label":"everybody on the same timezone permalink",className:"anchor before"},s.createElement(e.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Everybody on the same timezone!"),"\n",s.createElement(e.p,null,"To prevent problems related to timezones (e.g. date formating), you can set node timezone in jest\nconfig file. Now you are sure all tests are executed on the same timezone no matter where your\ncolleagues or your CI server are."),"\n",s.createElement(e.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// jest.config.js</span>\nprocess<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">TZ</span> <span class="token operator">=</span> <span class="token string">\'GMT\'</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token comment">// ...</span>\n<span class="token punctuation">}</span></code></pre></div>'}}),"\n",s.createElement(e.p,null,"See also:\n",s.createElement(e.a,{href:"https://en.wikipedia.org/wiki/List_of_tz_database_time_zones"},"the full list of timezones (column ",s.createElement(e.em,null,"TZ database name"),")")),"\n",s.createElement(e.h2,{id:"mock-datenow",style:{position:"relative"}},s.createElement(e.a,{href:"#mock-datenow","aria-label":"mock datenow permalink",className:"anchor before"},s.createElement(e.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Mock Date.now"),"\n",s.createElement(e.p,null,"Let‚Äôs say I want to test a dashboard component which tells me ‚Äúhello‚Äù with the date of the day. The\nlazy way is to only test the Hello part (without the date). Because it changes every day. But you\nwon‚Äôt test the date formatting part."),"\n",s.createElement(e.p,null,"If you want to, you gonna have to mock ",s.createElement(e.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">Date.now()</code>'}})," and put a default one."),"\n",s.createElement(e.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// your-test.spec.js</span>\n\n<span class="token keyword">const</span> RealNow <span class="token operator">=</span> Date<span class="token punctuation">.</span>now\n\n<span class="token function">beforeAll</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  global<span class="token punctuation">.</span>Date<span class="token punctuation">.</span>now <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">\'2019-04-07T10:20:30Z\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n<span class="token function">afterAll</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  global<span class="token punctuation">.</span>Date<span class="token punctuation">.</span>now <span class="token operator">=</span> RealNow\n<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>'}}),"\n",s.createElement(e.p,null,"Now in the same file, you can add something like the following:"),"\n",s.createElement(e.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">\'should show a formatted date of today\'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> dashboard <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">Mount</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Dashboard <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span>\n  <span class="token function">expect</span><span class="token punctuation">(</span>dashboard<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveText</span><span class="token punctuation">(</span><span class="token string">\'Hi Max, today is 7 April 2019\'</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>'}}),"\n",s.createElement(e.p,null,"üí°",s.createElement(e.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">RealDate</code>'}})," store ‚Äúreal‚Äù Date instance, so we can put it back afterwards."),"\n",s.createElement(e.h2,{id:"using-momentjs",style:{position:"relative"}},s.createElement(e.a,{href:"#using-momentjs","aria-label":"using momentjs permalink",className:"anchor before"},s.createElement(e.span,{dangerouslySetInnerHTML:{__html:'<svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg>'}})),"Using Moment.js?"),"\n",s.createElement(e.p,null,"You are probably using the very popular moment.js library. If so, mocking ",s.createElement(e.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">Date.now</code>'}}),", will probably\nnot be enough. A workaround is to\n",s.createElement(e.a,{href:"https://jestjs.io/docs/en/manual-mocks#mocking-node-modules"},"mock the entire node module"),"."),"\n",s.createElement(e.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">// &lt;root>/__mocks__/moment.js</span>\n<span class="token keyword">const</span> moment <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">requireActual</span><span class="token punctuation">(</span><span class="token string">\'moment\'</span><span class="token punctuation">)</span>\n\nDate<span class="token punctuation">.</span><span class="token function-variable function">now</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">\'2019-04-07T10:20:30Z\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> moment</code></pre></div>'}}),"\n",s.createElement(e.p,null,"With this solution, you don‚Äôt need ",s.createElement(e.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">beforeAll()</code>'}}),"/",s.createElement(e.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">afterAll()</code>'}})," listener. This mock will be effective\nfor all tests. And, every time ",s.createElement(e.span,{dangerouslySetInnerHTML:{__html:'<code class="language-text">moment()</code>'}})," is called, return date will be the same üéâ"),"\n",s.createElement(e.blockquote,null,"\n",s.createElement(e.p,null,"Big shout out to Avalander for pointing out some errors. https://dev.to/avalander/comment/ibc7"),"\n"))}var l=function(n){void 0===n&&(n={});const{wrapper:e}=Object.assign({},(0,t.ah)(),n.components);return e?s.createElement(e,n,s.createElement(o,n)):o(n)},c=a(4222),p=a(418),r=a(4529),u=a(7953),i=a(4849),m=a(5536),d=a(2404);function k(n){let{data:e,pageContext:a,children:t,location:o}=n;const l=e.post,{previous:k,next:h}=a;return s.createElement(c.Z,{location:o},s.createElement(m.Z,{title:l.frontmatter.title,description:l.frontmatter.description||l.excerpt,cover:l.frontmatter.cover&&l.frontmatter.cover.publicURL,imageShare:l.frontmatter.imageShare&&l.frontmatter.imageShare.publicURL,lang:l.frontmatter.language,translations:l.frontmatter.translations,path:l.frontmatter.slug,isBlogPost:!0}),s.createElement(r.Z,{heroImg:l.frontmatter.cover,title:l.frontmatter.title}),s.createElement(p.Z,null,s.createElement(u.Z,{post:l},t)),s.createElement(p.Z,{as:"aside"},s.createElement(d.Z,{slug:l.frontmatter.slug,title:l.frontmatter.title,redditPostId:l.frontmatter.redditPostId})),s.createElement(i.Z,{previous:k,next:h}))}function h(n){return s.createElement(k,n,s.createElement(l,n))}}}]);
//# sourceMappingURL=component---src-templates-blog-post-js-content-file-path-content-posts-2019-2019-11-18-jest-mock-date-index-md-ab7a2812863b97199d13.js.map